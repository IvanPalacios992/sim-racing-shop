# Web Architecture Documentation

## Descripción General

SimRacing Shop Web es el frontend de la plataforma e-commerce para hardware de sim racing personalizable. Está construido con **Next.js 16** usando App Router, internacionalización con **next-intl**, y un sistema de diseño oscuro personalizado orientado al mundo del motorsport.

### Stack Tecnológico

| Tecnología | Versión | Uso |
|------------|---------|-----|
| Next.js | 16.1.5 | Framework React con App Router y React Compiler |
| React | 19.2.3 | Librería de UI con soporte para Server Components |
| TypeScript | 5.x | Tipado estático |
| Tailwind CSS | 4.x | Utilidades CSS con diseño basado en tokens |
| Zustand | 5.0.10 | Gestión de estado global con persistencia |
| Axios | 1.13.4 | Cliente HTTP con interceptores de autenticación |
| React Hook Form | 7.71.1 | Gestión de formularios |
| Zod | 4.3.6 | Validación de esquemas |
| next-intl | 4.8.0 | Internacionalización (es/en) |
| Radix UI | — | Primitivas de UI accesibles (Dialog, Checkbox, Select, Label) |
| Lucide React | 0.563.0 | Iconografía |
| class-variance-authority | 0.7.1 | Variantes de componentes UI |
| React Three Fiber | 9.5.0 | Renderizado 3D (visor de productos) |
| Stripe.js | 8.6.4 | Integración de pagos |

### Arquitectura de Capas

```
┌─────────────────────────────────────────────────────────────┐
│                     Páginas (App Router)                     │
│        Server Components + Client Components (RSC)          │
├─────────────────────────────────────────────────────────────┤
│                       Componentes                           │
│           Auth Components / UI Primitives (Radix)           │
├─────────────────────────────────────────────────────────────┤
│                    Lógica de Negocio                         │
│       Stores (Zustand) / Validaciones (Zod) / Tipos         │
├─────────────────────────────────────────────────────────────┤
│                    Capa de Servicios                         │
│         API Client (Axios) / Auth API / Interceptores       │
├─────────────────────────────────────────────────────────────┤
│                    Infraestructura                           │
│      i18n (next-intl) / Middleware / CSS Design System      │
└─────────────────────────────────────────────────────────────┘
```

### Estructura del Proyecto

```
frontend/
├── messages/
│   ├── en.json                     # Traducciones inglés
│   └── es.json                     # Traducciones español
├── public/                         # Assets estáticos
├── src/
│   ├── app/
│   │   ├── globals.css             # Design system y tokens CSS
│   │   ├── layout.tsx              # Root layout (fuentes, metadata, tema)
│   │   ├── page.tsx                # Redirect / → /es
│   │   └── [locale]/
│   │       ├── layout.tsx          # Locale layout (NextIntlClientProvider)
│   │       ├── page.tsx            # Home page (server component)
│   │       ├── HomeContent.tsx     # Home page (client component)
│   │       ├── (auth)/
│   │       │   ├── layout.tsx      # Auth guard + layout
│   │       │   ├── login/page.tsx
│   │       │   ├── register/page.tsx
│   │       │   ├── forgot-password/page.tsx
│   │       │   └── reset-password/
│   │       │       ├── page.tsx
│   │       │       └── ResetPasswordContent.tsx
│   │       └── productos/
│   │           ├── page.tsx              # Listado de productos (server component)
│   │           ├── ProductsPageContent.tsx # Listado (client component)
│   │           └── [slug]/
│   │               ├── page.tsx              # Detalle de producto (server + generateMetadata)
│   │               └── ProductDetailContent.tsx # Detalle (client component)
│   ├── components/
│   │   ├── auth/                   # Componentes de autenticación
│   │   │   ├── index.ts            # Barrel exports
│   │   │   ├── AuthCard.tsx
│   │   │   ├── AuthLayout.tsx
│   │   │   ├── AuthRedirectGuard.tsx
│   │   │   ├── LoginForm.tsx
│   │   │   ├── RegisterForm.tsx
│   │   │   ├── ForgotPasswordForm.tsx
│   │   │   ├── ResetPasswordForm.tsx
│   │   │   ├── PasswordInput.tsx
│   │   │   └── PasswordRequirements.tsx
│   │   ├── products/               # Componentes de productos
│   │   │   ├── index.ts            # Barrel exports
│   │   │   ├── ProductCard.tsx
│   │   │   ├── ProductGrid.tsx
│   │   │   ├── ProductFilters.tsx
│   │   │   ├── Pagination.tsx
│   │   │   ├── ProductImageGallery.tsx
│   │   │   ├── ProductInfo.tsx
│   │   │   ├── ProductSpecifications.tsx
│   │   │   └── ProductJsonLd.tsx
│   │   └── ui/                     # Primitivas UI (shadcn/ui + Radix)
│   │       ├── button.tsx
│   │       ├── card.tsx
│   │       ├── checkbox.tsx
│   │       ├── input.tsx
│   │       └── label.tsx
│   ├── i18n/
│   │   ├── routing.ts              # Locales y estrategia de prefijo
│   │   ├── request.ts              # Configuración server-side i18n
│   │   └── navigation.ts           # Link, useRouter, usePathname localizados
│   ├── lib/
│   │   ├── api-client.ts           # Instancia Axios con interceptores JWT
│   │   ├── utils.ts                # Utilidad cn() (clsx + tailwind-merge)
│   │   ├── api/
│   │   │   ├── auth.ts             # Funciones de API de autenticación
│   │   │   └── products.ts         # Funciones de API de productos
│   │   └── validations/
│   │       └── auth.ts             # Esquemas Zod para formularios auth
│   ├── middleware.ts               # Middleware next-intl (detección de locale)
│   ├── stores/
│   │   └── auth-store.ts           # Store Zustand de autenticación
│   └── types/
│       ├── auth.ts                 # Tipos TypeScript (DTOs auth, store)
│       └── products.ts             # Tipos TypeScript (DTOs productos)
├── tests/
│   ├── setup.ts                    # Configuración Vitest (jest-dom, mocks)
│   ├── helpers/
│   │   ├── render.tsx              # Custom render con NextIntlClientProvider
│   │   └── auth-store.ts           # Helpers de reset y mock del store
│   ├── unit/                       # Tests unitarios (validaciones, store)
│   ├── components/                 # Tests de componentes (Testing Library)
│   └── e2e/                        # Tests E2E (Playwright)
├── next.config.ts                  # Configuración Next.js + plugin next-intl
├── playwright.config.ts            # Configuración Playwright
├── tsconfig.json                   # TypeScript (alias @/*, excluye tests)
└── package.json
```

### Características de Seguridad

- **Renovación automática de tokens**: Interceptor Axios detecta respuestas 401 y renueva el JWT usando el refresh token, con cola de peticiones concurrentes para evitar múltiples refreshes simultáneos.
- **Protección de rutas auth**: `AuthRedirectGuard` redirige usuarios autenticados fuera de las páginas de login/registro.
- **Validación dual**: Validación en cliente (Zod) y servidor (ASP.NET Identity) con mensajes de error localizados.
- **Almacenamiento persistente**: Tokens y estado de autenticación persistidos en `localStorage` vía Zustand `persist` middleware.
- **Limpieza de sesión**: Logout limpia el estado local independientemente de la respuesta del servidor.
- **Prevención de enumeración**: La página de forgot-password siempre muestra éxito, sin revelar si el email existe.

---

## Esquema de Navegación

### Mapa de Rutas

```
/                                    → Redirect a /{defaultLocale}
│
├── /es                              → Home (español)
├── /en                              → Home (inglés)
│
├── /{locale}/login                  → Inicio de sesión
├── /{locale}/register               → Registro
├── /{locale}/forgot-password        → Solicitar restablecimiento de contraseña
├── /{locale}/reset-password         → Restablecer contraseña (?email=...&token=...)
│
├── /{locale}/productos              → Listado de productos (paginado, filtros)
└── /{locale}/productos/{slug}       → Detalle de producto (dinámico, SSR)
```

### Internacionalización (i18n)

- **Locales soportados**: `es` (español, por defecto), `en` (inglés).
- **Estrategia de prefijo**: `always` — todas las URLs incluyen el prefijo de locale.
- **Middleware**: Intercepta todas las peticiones (excepto `/api`, `/_next`, y archivos estáticos) para detectar el locale y redirigir si es necesario.
- **Archivos de mensajes**: `messages/es.json` y `messages/en.json` con claves organizadas por sección (`common`, `auth`, `home`, `products`, `productDetail`, `nav`).

### Flujo de Navegación

```mermaid
flowchart TD
    A["/ (raíz)"] -->|redirect| B["/{locale} (Home)"]

    B -->|no autenticado| C["Botón Sign In"]
    B -->|no autenticado| D["Botón Create Account"]
    B -->|autenticado| E["Botón Log Out"]

    C --> F["/{locale}/login"]
    D --> G["/{locale}/register"]

    F -->|login exitoso| B
    G -->|registro exitoso| B
    E -->|logout| B

    F -->|"Forgot password?"| H["/{locale}/forgot-password"]
    F -->|"Create one"| G
    G -->|"Sign In"| F

    H -->|envío exitoso| I["Estado: Check Your Email"]
    I -->|"Try a different email"| H
    I -->|email con enlace| J["/{locale}/reset-password?email=...&token=..."]

    J -->|reset exitoso| K["Estado: Password Reset Complete"]
    K -->|"SIGN IN NOW"| F

    J -->|token inválido| L["Estado: Token inválido"]
    L -->|"Request new link"| H

    B -->|"Explorar Productos"| M["/{locale}/productos"]
    M -->|click en producto| N["/{locale}/productos/{slug}"]
    N -->|breadcrumb "Productos"| M
    N -->|breadcrumb "Inicio"| B
```

### Layouts y Grupos de Rutas

```
Root Layout (layout.tsx)
│   → Fuentes Geist Sans/Mono, tema dark, metadata global
│
└── [locale] Layout (layout.tsx)
    │   → Validación de locale, NextIntlClientProvider
    │
    ├── Home Page (page.tsx + HomeContent.tsx)
    │   → Contenido condicional según autenticación
    │
    ├── (auth) Group Layout (layout.tsx)
    │   │   → AuthRedirectGuard + AuthLayout (centrado full-screen)
    │   │
    │   ├── /login          → AuthCard + LoginForm
    │   ├── /register       → AuthCard + RegisterForm
    │   ├── /forgot-password → AuthCard + ForgotPasswordForm
    │   └── /reset-password → AuthCard + ResetPasswordForm
    │
    └── /productos
        ├── Listado (page.tsx + ProductsPageContent.tsx)
        │   → Grid de productos con filtros, búsqueda y paginación
        │
        └── /[slug] (page.tsx + ProductDetailContent.tsx)
            → Detalle de producto con galería, info, specs y JSON-LD
```

El grupo `(auth)` es un **Route Group** de Next.js: agrupa las páginas de autenticación bajo un layout común sin añadir un segmento a la URL. Todas las páginas dentro comparten:
1. **`AuthRedirectGuard`**: Si el usuario está autenticado, redirige a `/`.
2. **`AuthLayout`**: Layout full-screen con fondo oscuro que centra el contenido.

---

## Descripción de Páginas y Componentes

### Páginas

#### Home (`/{locale}`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/page.tsx` + `HomeContent.tsx` |
| Tipo | Server Component (wrapper) + Client Component (contenido) |
| Autenticación | No requerida |

**Descripción**: Página principal de la aplicación. El server component establece el locale y delega al client component `HomeContent`, que lee el estado de autenticación del store Zustand.

**Comportamiento condicional**:
- **No autenticado**: Muestra el logo "SIMRACING**SHOP**", el tagline, y dos botones: "Sign In" (fondo rojo) y "Create Account" (borde blanco).
- **Autenticado**: Muestra "Welcome, {nombre}" y un botón "Log Out" que llama a `authApi.logout()` y limpia el store.

---

#### Login (`/{locale}/login`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/(auth)/login/page.tsx` |
| Tipo | Server Component + Client Component (`LoginForm`) |
| Autenticación | Redirige a home si ya autenticado |

**Descripción**: Página de inicio de sesión envuelta en `AuthCard` con título "Welcome Back" y subtítulo "Sign in to your account".

**Formulario** (`LoginForm`):

| Campo | Tipo | Validación |
|-------|------|------------|
| Email | `<Input>` | Requerido, formato email válido |
| Password | `<PasswordInput>` | Requerido |
| Remember me | `<Checkbox>` | Opcional (default: false) |

**Acciones**:
- **Submit ("SIGN IN")**: Llama `authApi.login()`, almacena tokens en store, redirige a `/`.
- **"Forgot password?"**: Enlace a `/forgot-password`.
- **"Create one"**: Enlace a `/register`.

**Errores**:

| Código HTTP | Mensaje mostrado |
|-------------|------------------|
| 401 | "Invalid email or password. Please try again." |
| 423 | "Account temporarily locked. Please try again later." |
| 403 | "Please verify your email before signing in." |
| Otro | "Could not sign in. Please try again." |

---

#### Register (`/{locale}/register`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/(auth)/register/page.tsx` |
| Tipo | Server Component + Client Component (`RegisterForm`) |
| Autenticación | Redirige a home si ya autenticado |

**Descripción**: Página de registro envuelta en `AuthCard` con título "Create Account" y un enlace "Sign In" en el subtítulo.

**Formulario** (`RegisterForm`):

| Campo | Tipo | Validación |
|-------|------|------------|
| First Name | `<Input>` | Opcional |
| Last Name | `<Input>` | Opcional |
| Email | `<Input>` | Requerido, formato email válido |
| Password | `<PasswordInput>` | Requerido, min 8 chars, mayúscula, minúscula, dígito |
| Confirm Password | `<PasswordInput>` | Requerido, debe coincidir con Password |
| Accept Terms | `<Checkbox>` | Requerido (debe ser true) |
| Newsletter | `<Checkbox>` | Opcional |

**Características**:
- Los campos First Name y Last Name se muestran en grid de 2 columnas.
- Al escribir en el campo Password, se muestra el componente `PasswordRequirements` con indicadores en tiempo real.
- El envío incluye el `locale` actual como parámetro `language` para la API.

**Errores**:

| Código HTTP | Mensaje mostrado |
|-------------|------------------|
| 409 | "This email is already registered." |
| Otro | "Could not create account. Please try again." |

---

#### Forgot Password (`/{locale}/forgot-password`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/(auth)/forgot-password/page.tsx` |
| Tipo | Server Component + Client Component (`ForgotPasswordForm`) |
| Autenticación | Redirige a home si ya autenticado |

**Descripción**: Página de solicitud de restablecimiento de contraseña. Componente con dos estados internos.

**Estado: Formulario**

| Campo | Tipo | Validación |
|-------|------|------------|
| Email | `<Input>` | Requerido, formato email válido |

- **Submit ("SEND RESET LINK")**: Llama `authApi.forgotPassword()`, transiciona al estado success.
- **"Back to Sign In"**: Enlace a `/login`.

**Estado: Success ("Check Your Email")**

- Muestra icono de correo verde y el email al que se envió el enlace.
- **Botón "Resend Email"**: Deshabilitado durante un cooldown de 60 segundos con cuenta regresiva visible ("Resend in {n}s"). Se habilita al expirar el temporizador.
- **"Try a different email"**: Vuelve al estado formulario.

**Errores**:

| Escenario | Mensaje mostrado |
|-----------|------------------|
| Error de red/API | "Could not send email. Please try again." |

---

#### Reset Password (`/{locale}/reset-password`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/(auth)/reset-password/page.tsx` + `ResetPasswordContent.tsx` |
| Tipo | Server Component + Client Component con `useSearchParams()` |
| Autenticación | Redirige a home si ya autenticado |
| Parámetros URL | `?email={email}&token={token}` |

**Descripción**: Página de restablecimiento de contraseña. Envuelta en `Suspense` porque usa `useSearchParams()`. Si faltan los parámetros `email` o `token` en la URL, muestra directamente el estado de token inválido.

**Estado: Formulario** (`ResetPasswordForm`)

| Campo | Tipo | Validación |
|-------|------|------------|
| New Password | `<PasswordInput>` | Requerido, min 8 chars, mayúscula, minúscula, dígito |
| Confirm Password | `<PasswordInput>` | Requerido, debe coincidir con New Password |

- Muestra `PasswordRequirements` en tiempo real al escribir la contraseña.
- **Submit ("RESET PASSWORD")**: Llama `authApi.resetPassword()` con email, token, newPassword y confirmPassword.

**Estado: Success ("Password Reset Complete")**

- Muestra icono de check verde y mensaje de éxito.
- **"SIGN IN NOW"**: Enlace a `/login`.

**Estado: Token Inválido**

- Muestra icono X rojo y mensaje de token inválido o expirado.
- **"Request new link"**: Enlace a `/forgot-password`.

**Errores**:

| Código HTTP | Estado resultante |
|-------------|-------------------|
| 400/404 | Transiciona al estado "Token Inválido" |
| Otro | Muestra mensaje genérico en el formulario |

---

#### Listado de Productos (`/{locale}/productos`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/productos/page.tsx` + `ProductsPageContent.tsx` |
| Tipo | Server Component (wrapper) + Client Component (contenido) |
| Autenticación | No requerida |

**Descripción**: Página de catálogo que muestra todos los productos activos. El server component establece el locale y delega al client component `ProductsPageContent`, que gestiona filtros, búsqueda, ordenamiento y paginación.

**Funcionalidades**:
- **Búsqueda**: Campo de texto con debounce de 300ms.
- **Filtros**: Rango de precio (min/max), solo personalizables.
- **Ordenamiento**: Destacados, precio ascendente/descendente, más recientes, nombre.
- **Paginación**: 12 productos por página con navegación previa/siguiente.
- **Estado en URL**: Todos los filtros se sincronizan con los query params de la URL.

**Componentes utilizados**: `ProductGrid`, `ProductFilters`, `Pagination`, `ProductCard`.

**Endpoint API**: `GET /api/products` con parámetros `Page`, `PageSize`, `Locale`, `Search`, `MinPrice`, `MaxPrice`, `IsCustomizable`, `SortBy`, `SortDescending`.

---

#### Detalle de Producto (`/{locale}/productos/{slug}`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/productos/[slug]/page.tsx` + `ProductDetailContent.tsx` |
| Tipo | Server Component (wrapper con `generateMetadata`) + Client Component |
| Autenticación | No requerida |
| Renderizado | Dinámico (server-rendered on demand) |

**Descripción**: Página de detalle de producto (PDP). El server component genera metadata SEO (título, descripción, Open Graph) llamando al API server-side. El client component `ProductDetailContent` realiza el fetch del producto y compone las secciones.

**Layout**:
```
Desktop (≥1024px): Grid 2 columnas [55% | 45%]
Mobile  (<1024px): 1 columna (galería arriba, info abajo)

┌──────────────────────────┬──────────────────────┐
│  ProductImageGallery     │  ProductInfo          │
│  • Imagen principal      │  • Breadcrumb         │
│  • Thumbnails            │  • Nombre (h1)        │
│                          │  • SKU + badge        │
│                          │  • Precio con IVA     │
│                          │  • Estado de stock    │
│                          │  • Descripción corta  │
│                          │  • Botón PERSONALIZAR │
│                          │  • Trust indicators   │
├──────────────────────────┴──────────────────────┤
│  ProductSpecifications                           │
│  • Tabla de especificaciones técnicas            │
├──────────────────────────────────────────────────┤
│  Descripción larga (si existe)                   │
└──────────────────────────────────────────────────┘
```

**SEO**:
- `generateMetadata`: Usa `metaTitle`, `metaDescription` del producto para `<title>` y OG tags.
- `ProductJsonLd`: Inyecta schema.org/Product con nombre, descripción, SKU, imágenes, oferta (precio EUR, disponibilidad).

**Estados**:
- **Loading**: Skeleton loader animado (`animate-pulse`) respetando el layout 2 columnas.
- **Error/404**: Mensaje de error centrado con botón "Reintentar".
- **Éxito**: Layout completo con todas las secciones.

**Endpoint API**: `GET /api/products/slug/{slug}?Locale={locale}` → `ProductDetailDto`.

---

### Componentes

#### AuthCard

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/AuthCard.tsx` |
| Tipo | Client Component |

**Descripción**: Contenedor visual compartido por todas las páginas de autenticación. Renderiza una tarjeta con fondo `carbon`, borde `graphite` y ancho máximo de 420px.

**Props**:

| Prop | Tipo | Default | Descripción |
|------|------|---------|-------------|
| `title` | `string` | — | Título principal (renderizado como `<h1>`) |
| `subtitle` | `ReactNode` | — | Subtítulo opcional debajo del título |
| `showLogo` | `boolean` | `true` | Muestra el logo "SIMRACING**SHOP**" con enlace a home |
| `children` | `ReactNode` | — | Contenido del formulario |

---

#### AuthLayout

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/AuthLayout.tsx` |
| Tipo | Client Component |

**Descripción**: Layout full-screen con fondo `obsidian` que centra su contenido vertical y horizontalmente. Opcionalmente incluye un panel lateral de marca visible solo en pantallas `lg:` y superiores.

**Props**:

| Prop | Tipo | Default | Descripción |
|------|------|---------|-------------|
| `children` | `ReactNode` | — | Contenido principal (el AuthCard) |
| `showBrandPanel` | `boolean` | `false` | Muestra panel lateral con imagen de fondo |
| `brandContent` | `ReactNode` | — | Contenido del panel lateral |

---

#### AuthRedirectGuard

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/AuthRedirectGuard.tsx` |
| Tipo | Client Component |

**Descripción**: Guarda de protección que impide a usuarios autenticados acceder a las páginas de auth. Lee `isAuthenticated` del store Zustand y, si es `true`, ejecuta `router.replace("/")` y renderiza `null`. Si es `false`, renderiza los `children` normalmente.

---

#### LoginForm

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/LoginForm.tsx` |
| Tipo | Client Component |

**Descripción**: Formulario de inicio de sesión con validación Zod integrada a React Hook Form. Gestiona el flujo completo: validación → llamada API → almacenamiento de tokens → redirección.

**Esquema de validación** (`createLoginSchema`):
- `email`: Requerido, formato email válido.
- `password`: Requerido.
- `rememberMe`: Booleano opcional.

**Flujo de submit**:
1. Valida los campos con el esquema Zod.
2. Llama `authApi.login({ email, password, rememberMe })`.
3. En éxito: `useAuthStore.setAuth(response)` + `router.push("/")`.
4. En error: Mapea el código HTTP al mensaje i18n correspondiente y lo muestra como alerta.

---

#### RegisterForm

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/RegisterForm.tsx` |
| Tipo | Client Component |

**Descripción**: Formulario de registro con 7 campos, validación de fortaleza de contraseña en tiempo real, y requisitos visuales. El formulario más complejo de la aplicación.

**Esquema de validación** (`createRegisterSchema`):
- `firstName`, `lastName`: Opcionales.
- `email`: Requerido, formato válido.
- `password`: Requerido, min 8 chars, al menos una mayúscula, una minúscula y un dígito.
- `confirmPassword`: Debe coincidir con `password` (refinamiento Zod).
- `acceptTerms`: Debe ser `true`.
- `newsletter`: Booleano opcional.

**Flujo de submit**:
1. Valida los campos con el esquema Zod.
2. Llama `authApi.register({ ...data, language: locale })`.
3. En éxito: `useAuthStore.setAuth(response)` + `router.push("/")`.
4. En error: Mapea 409 a "email ya registrado", otros a mensaje genérico.

**Característica especial**: El componente `PasswordRequirements` se muestra condicionalmente cuando el campo password tiene contenido, proporcionando feedback visual en tiempo real.

---

#### ForgotPasswordForm

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/ForgotPasswordForm.tsx` |
| Tipo | Client Component |

**Descripción**: Componente con máquina de estados que gestiona dos vistas: el formulario de solicitud y el estado de confirmación con temporizador de reenvío.

**Estados internos**:
- `submitted: boolean` — Controla qué vista se muestra.
- `sentEmail: string` — Email enviado (para mostrarlo en la confirmación).
- `cooldown: number` — Cuenta regresiva en segundos (inicia en 60).

**Esquema de validación** (`createForgotPasswordSchema`):
- `email`: Requerido, formato válido.

**Temporizador de reenvío**: Implementado con `setInterval` que decrementa `cooldown` cada segundo. Al llegar a 0, el botón "Resend Email" se habilita. Al reenviar, el cooldown se reinicia a 60.

---

#### ResetPasswordForm

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/ResetPasswordForm.tsx` |
| Tipo | Client Component |

**Descripción**: Componente con tres estados posibles que gestiona el restablecimiento de contraseña usando el token recibido por email.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `email` | `string` | Email del usuario (de los query params) |
| `token` | `string` | Token de restablecimiento (de los query params) |

**Estados internos**: `"form"` | `"success"` | `"invalidToken"`.

**Esquema de validación** (`createResetPasswordSchema`):
- `newPassword`: Requerido, min 8 chars, mayúscula, minúscula, dígito.
- `confirmPassword`: Debe coincidir con `newPassword`.

**Flujo de submit**:
1. Valida los campos con el esquema Zod.
2. Llama `authApi.resetPassword({ email, token, newPassword, confirmPassword })`.
3. En éxito: Transiciona al estado `"success"`.
4. En error 400/404: Transiciona al estado `"invalidToken"`.
5. En otro error: Muestra mensaje genérico en el formulario.

---

#### PasswordInput

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/PasswordInput.tsx` |
| Tipo | Client Component (`forwardRef`) |

**Descripción**: Campo de contraseña con botón de toggle para mostrar/ocultar el texto. Usa `forwardRef` para compatibilidad con `react-hook-form`.

**Props**: Extiende `React.InputHTMLAttributes<HTMLInputElement>` con:

| Prop | Tipo | Default | Descripción |
|------|------|---------|-------------|
| `showLabel` | `string` | `"Show"` | Texto sr-only cuando la contraseña está oculta |
| `hideLabel` | `string` | `"Hide"` | Texto sr-only cuando la contraseña es visible |

**Comportamiento**: Alterna entre `type="password"` y `type="text"`. El botón de toggle tiene `tabIndex={-1}` para no interferir con la navegación por teclado. Incluye iconos `Eye`/`EyeOff` de Lucide React y etiquetas `sr-only` para accesibilidad.

---

#### PasswordRequirements

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/PasswordRequirements.tsx` |
| Tipo | Client Component |

**Descripción**: Indicador visual de fortaleza de contraseña que evalúa 4 requisitos en tiempo real.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `password` | `string` | Valor actual del campo de contraseña |
| `labels` | `object` | Textos i18n para título y cada requisito |

**Requisitos evaluados**:

| Requisito | Regla | Icono cumplido | Icono no cumplido |
|-----------|-------|-----------------|---------------------|
| Longitud mínima | ≥ 8 caracteres | Check (verde) | X (gris) |
| Mayúscula | Al menos una `[A-Z]` | Check (verde) | X (gris) |
| Minúscula | Al menos una `[a-z]` | Check (verde) | X (gris) |
| Número | Al menos un `[0-9]` | Check (verde) | X (gris) |

Usa la función `checkPasswordRequirements()` del módulo de validaciones para evaluar cada regla.

---

#### ProductCard

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/ProductCard.tsx` |
| Tipo | Client Component |

**Descripción**: Tarjeta de producto reutilizable para el grid del catálogo. Muestra imagen, SKU, nombre, descripción corta y precio. Envuelta en un `<Link>` que navega a la página de detalle (`/productos/{slug}`).

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `product` | `ProductListItem` | Datos del producto desde la API |

**Características**:
- Badge "Personalizable" (`bg-electric-blue`) si `isCustomizable` es `true`.
- Botón de wishlist (corazón) con `e.preventDefault()` para evitar navegación al hacer clic.
- Hover: Elevación (`-translate-y-1`), borde visible y zoom sutil en la imagen.
- Fallback SVG cuando no hay imagen disponible.

---

#### ProductGrid

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/ProductGrid.tsx` |
| Tipo | Client Component |

**Descripción**: Grid responsivo que renderiza `ProductCard` o skeletons de carga. Layout de 1 a 3 columnas según el breakpoint.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `products` | `ProductListItem[]` | Array de productos |
| `loading` | `boolean` | Muestra skeletons si `true` |

---

#### ProductFilters

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/ProductFilters.tsx` |
| Tipo | Client Component |

**Descripción**: Panel lateral de filtros para el catálogo. Incluye campo de búsqueda, rango de precio, toggle de personalizables y selector de ordenamiento.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `filters` | `FilterValues` | Estado actual de los filtros |
| `onFiltersChange` | `(filters: FilterValues) => void` | Callback cuando los filtros cambian |

---

#### Pagination

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/Pagination.tsx` |
| Tipo | Client Component |

**Descripción**: Controles de paginación con botones anterior/siguiente e indicador de página actual.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `currentPage` | `number` | Página actual |
| `totalPages` | `number` | Total de páginas |
| `onPageChange` | `(page: number) => void` | Callback al cambiar de página |

---

#### ProductImageGallery

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/ProductImageGallery.tsx` |
| Tipo | Client Component |

**Descripción**: Galería de imágenes del producto con imagen principal y tira de thumbnails. Las imágenes se ordenan por `displayOrder`. El thumbnail seleccionado se resalta con borde `racing-red`.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `images` | `ProductImage[]` | Array de imágenes del producto |
| `productName` | `string` | Nombre del producto (para alt text) |

**Estados internos**: `selectedIndex` — Índice de la imagen seleccionada.

**Comportamiento**:
- Click en thumbnail cambia la imagen principal.
- Tira de thumbnails con scroll horizontal (`overflow-x-auto`).
- Fallback SVG cuando el array de imágenes está vacío.

---

#### ProductInfo

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/ProductInfo.tsx` |
| Tipo | Client Component |

**Descripción**: Sección de información del producto. Muestra breadcrumb, nombre, precio con IVA, estado de stock, descripción corta, botón de personalización y trust indicators.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `product` | `ProductDetail` | Datos completos del producto |

**Secciones renderizadas**:
1. **Breadcrumb**: Inicio / Productos / {nombre} (usando `<Link>` de `@/i18n/navigation`).
2. **Nombre**: `<h1>` con `text-3xl md:text-4xl font-bold`.
3. **SKU + Badge**: SKU en texto secundario, badge "Personalizable" si aplica.
4. **Rating**: Placeholder con 5 cuadros grises (sin sistema de reviews implementado).
5. **Precio**: Precio con IVA en grande + precio sin IVA y tasa en texto secundario. Cálculo: `basePrice * (1 + vatRate / 100)`.
6. **Stock**: Indicador verde "En stock" si `isActive`, rojo "Agotado" si no.
7. **Descripción corta**: Si existe `shortDescription`.
8. **Botón "PERSONALIZAR"**: Visible solo si `isCustomizable`, estilo CTA primario (`bg-racing-red`).
9. **Tiempo de producción**: Icono reloj + `{baseProductionDays} días`.
10. **Peso**: Si existe `weightGrams`, icono paquete + `{grams}g`.
11. **Trust indicators**: Envío gratis, garantía 2 años, pago seguro (iconos Lucide en `electric-blue`).

---

#### ProductSpecifications

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/ProductSpecifications.tsx` |
| Tipo | Client Component |

**Descripción**: Tabla de especificaciones técnicas con filas alternadas (zebra stripes). Las especificaciones se ordenan por `displayOrder`.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `specifications` | `ProductSpecification[]` | Array de especificaciones |

**Estilo**: Filas pares con `bg-graphite/50`, impares con `bg-carbon`. Clave en `text-silver`, valor en `text-white`.

---

#### ProductJsonLd

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/ProductJsonLd.tsx` |
| Tipo | Component (sin `"use client"`) |

**Descripción**: Componente que inyecta un `<script type="application/ld+json">` con datos estructurados schema.org/Product para SEO.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `product` | `ProductDetail` | Datos del producto |
| `locale` | `string` | Locale actual |

**Schema generado**:
- `@type`: `Product`
- `name`, `description`, `sku`: Datos del producto.
- `image`: Array de URLs de imágenes ordenadas por `displayOrder`.
- `offers`: Tipo `Offer` con precio (IVA incluido, EUR), disponibilidad (`InStock`/`OutOfStock`), URL canónica.
- `weight`: (opcional) `QuantitativeValue` en gramos si `weightGrams` existe.

---

### Componentes UI (Primitivas)

Basados en el patrón **shadcn/ui** con primitivas **Radix UI** y estilizado con **Tailwind CSS** y **class-variance-authority**.

| Componente | Archivo | Base | Descripción |
|------------|---------|------|-------------|
| `Button` | `ui/button.tsx` | CVA | Botón con variantes (`default`, `destructive`, `outline`, `secondary`, `ghost`, `link`) y tamaños (`xs`, `sm`, `default`, `lg`, `icon`). Soporta `asChild` vía Radix `Slot`. |
| `Card` | `ui/card.tsx` | div | Conjunto de componentes (`Card`, `CardHeader`, `CardTitle`, `CardDescription`, `CardAction`, `CardContent`, `CardFooter`) con atributos `data-slot` para targeting CSS. |
| `Checkbox` | `ui/checkbox.tsx` | Radix Checkbox | Checkbox accesible con indicador `CheckIcon` de Lucide. |
| `Input` | `ui/input.tsx` | input | Campo de texto con estilos consistentes, focus ring, y soporte `aria-invalid`. |
| `Label` | `ui/label.tsx` | Radix Label | Etiqueta accesible con estilos tipográficos consistentes. |

---

### Sistema de Diseño

#### Paleta de Colores

El tema visual está orientado al mundo del motorsport con una paleta oscura y acentos vibrantes:

```
Fondos                    Acentos                   Estados
┌──────────────────┐     ┌──────────────────┐      ┌──────────────────┐
│ obsidian  #0A0A0A│     │ racing-red #E53935│      │ success  #22C55E │
│ (fondo principal)│     │ (CTA principal)   │      │ (éxito)          │
├──────────────────┤     ├──────────────────┤      ├──────────────────┤
│ carbon    #171717│     │ electric   #2196F3│      │ warning  #F59E0B │
│ (tarjetas)       │     │ -blue (enlaces)   │      │ (advertencia)    │
├──────────────────┤     ├──────────────────┤      ├──────────────────┤
│ graphite  #262626│     │ champagne  #C9AF89│      │ error    #EF4444 │
│ (bordes)         │     │ (premium)         │      │ (error)          │
└──────────────────┘     └──────────────────┘      └──────────────────┘

Textos
┌──────────────────┐
│ white     #FFFFFF│  → Texto principal
│ silver    #9CA3AF│  → Texto secundario, placeholders
│ smoke     #4B5563│  → Texto terciario, ayuda
└──────────────────┘
```

#### Tipografía

- **Fuente principal**: Geist Sans (variable: `--font-geist-sans`)
- **Fuente monoespaciada**: Geist Mono (variable: `--font-geist-mono`)
- **Carga**: Google Fonts con subset `latin`

#### Tokens CSS

Los tokens están definidos en `globals.css` usando variables CSS nativas y el sistema OKLCH de shadcn/ui:

- **Border radius**: Sistema escalable desde `--radius: 0.625rem` con variantes `sm` a `4xl`.
- **Variante dark**: Activada por la clase `.dark` en `<html>` (siempre activa por defecto).
- **Animaciones**: Proporcionadas por `tw-animate-css`.
