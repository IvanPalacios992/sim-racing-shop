# Web Architecture Documentation

## Descripción General

SimRacing Shop Web es el frontend de la plataforma e-commerce para hardware de sim racing personalizable. Está construido con **Next.js 16** usando App Router, internacionalización con **next-intl**, y un sistema de diseño oscuro personalizado orientado al mundo del motorsport.

### Stack Tecnológico

| Tecnología | Versión | Uso |
|------------|---------|-----|
| Next.js | 16.1.5 | Framework React con App Router y React Compiler |
| React | 19.2.3 | Librería de UI con soporte para Server Components |
| TypeScript | 5.x | Tipado estático |
| Tailwind CSS | 4.x | Utilidades CSS con diseño basado en tokens |
| Zustand | 5.0.10 | Gestión de estado global con persistencia |
| Axios | 1.13.4 | Cliente HTTP con interceptores de autenticación |
| React Hook Form | 7.71.1 | Gestión de formularios |
| Zod | 4.3.6 | Validación de esquemas |
| next-intl | 4.8.0 | Internacionalización (es/en) |
| Radix UI | — | Primitivas de UI accesibles (Dialog, Checkbox, Select, Label) |
| Lucide React | 0.563.0 | Iconografía |
| class-variance-authority | 0.7.1 | Variantes de componentes UI |
| React Three Fiber | 9.5.0 | Renderizado 3D (visor de productos) |
| Stripe.js | 8.6.4 | Integración de pagos |

### Arquitectura de Capas

```
┌─────────────────────────────────────────────────────────────┐
│                     Páginas (App Router)                     │
│        Server Components + Client Components (RSC)          │
├─────────────────────────────────────────────────────────────┤
│                       Componentes                           │
│           Auth Components / UI Primitives (Radix)           │
├─────────────────────────────────────────────────────────────┤
│                    Lógica de Negocio                         │
│       Stores (Zustand) / Validaciones (Zod) / Tipos         │
├─────────────────────────────────────────────────────────────┤
│                    Capa de Servicios                         │
│         API Client (Axios) / Auth API / Interceptores       │
├─────────────────────────────────────────────────────────────┤
│                    Infraestructura                           │
│      i18n (next-intl) / Middleware / CSS Design System      │
└─────────────────────────────────────────────────────────────┘
```

### Estructura del Proyecto

```
frontend/
├── messages/
│   ├── en.json                     # Traducciones inglés
│   └── es.json                     # Traducciones español
├── public/                         # Assets estáticos
├── src/
│   ├── app/
│   │   ├── globals.css             # Design system y tokens CSS
│   │   ├── layout.tsx              # Root layout (fuentes, metadata, tema)
│   │   ├── page.tsx                # Redirect / → /es
│   │   └── [locale]/
│   │       ├── layout.tsx          # Locale layout (NextIntlClientProvider)
│   │       ├── page.tsx            # Home page (server component)
│   │       ├── HomeContent.tsx     # Home page (client component wrapper)
│   │       ├── (auth)/
│   │       │   ├── layout.tsx      # Auth guard + layout
│   │       │   ├── login/page.tsx
│   │       │   ├── register/page.tsx
│   │       │   ├── forgot-password/page.tsx
│   │       │   └── reset-password/
│   │       │       ├── page.tsx
│   │       │       └── ResetPasswordContent.tsx
│   │       ├── (private-area)/
│   │       │   ├── layout.tsx          # Private area guard + layout
│   │       │   ├── perfil/page.tsx
│   │       │   ├── configuracion/page.tsx
│   │       │   └── pedidos/
│   │       │       ├── page.tsx
│   │       │       └── [id]/page.tsx
│   │       ├── carrito/
│   │       │   ├── page.tsx              # Carrito (server + generateMetadata)
│   │       │   └── CartContent.tsx       # Carrito (client component)
│   │       └── productos/
│   │           ├── page.tsx              # Listado de productos (server component)
│   │           ├── ProductsPageContent.tsx # Listado (client component)
│   │           └── [slug]/
│   │               ├── page.tsx              # Detalle de producto (server + generateMetadata)
│   │               └── ProductDetailContent.tsx # Detalle (client component)
│   ├── components/
│   │   ├── auth/                   # Componentes de autenticación
│   │   │   ├── index.ts            # Barrel exports
│   │   │   ├── AuthCard.tsx
│   │   │   ├── AuthLayout.tsx
│   │   │   ├── AuthRedirectGuard.tsx
│   │   │   ├── LoginForm.tsx
│   │   │   ├── RegisterForm.tsx
│   │   │   ├── ForgotPasswordForm.tsx
│   │   │   ├── ResetPasswordForm.tsx
│   │   │   ├── PasswordInput.tsx
│   │   │   └── PasswordRequirements.tsx
│   │   ├── private-area/           # Componentes del área privada
│   │   │   ├── PrivateAreaGuard.tsx
│   │   │   ├── PrivateAreaLayout.tsx
│   │   │   ├── ProfileContent.tsx
│   │   │   ├── SettingsContent.tsx
│   │   │   ├── EditUserModal.tsx
│   │   │   ├── BillingAddressCard.tsx
│   │   │   ├── DeliveryAddressCard.tsx
│   │   │   ├── AddBillingAddressModal.tsx
│   │   │   ├── AddDeliveryAddressModal.tsx
│   │   │   └── orders/             # Componentes de pedidos
│   │   │       ├── OrdersContent.tsx
│   │   │       ├── OrderDetailContent.tsx
│   │   │       ├── OrderCard.tsx
│   │   │       └── OrderStatusBadge.tsx
│   │   ├── home/                   # Componentes de la home
│   │   │   ├── index.ts            # Barrel exports
│   │   │   ├── HeroSection.tsx
│   │   │   ├── FeaturedCategories.tsx
│   │   │   ├── FeaturedProducts.tsx
│   │   │   ├── ConfiguratorPromo.tsx
│   │   │   ├── TrustIndicators.tsx
│   │   │   └── NewsletterSection.tsx
│   │   ├── cart/                   # Componentes del carrito
│   │   │   ├── MiniCart.tsx
│   │   │   ├── CartItemRow.tsx
│   │   │   ├── CartSummary.tsx
│   │   │   ├── CartToast.tsx
│   │   │   └── QuantitySelector.tsx
│   │   ├── layout/                 # Componentes de layout
│   │   │   ├── Navbar.tsx
│   │   │   └── Footer.tsx
│   │   ├── products/               # Componentes de productos
│   │   │   ├── index.ts            # Barrel exports
│   │   │   ├── ProductCard.tsx
│   │   │   ├── ProductGrid.tsx
│   │   │   ├── ProductFilters.tsx
│   │   │   ├── Pagination.tsx
│   │   │   ├── ProductImageGallery.tsx
│   │   │   ├── ProductInfo.tsx
│   │   │   ├── ProductSpecifications.tsx
│   │   │   └── ProductJsonLd.tsx
│   │   └── ui/                     # Primitivas UI (shadcn/ui + Radix)
│   │       ├── button.tsx
│   │       ├── card.tsx
│   │       ├── checkbox.tsx
│   │       ├── input.tsx
│   │       ├── label.tsx
│   │       ├── modal.tsx
│   │       └── switch.tsx
│   ├── i18n/
│   │   ├── routing.ts              # Locales y estrategia de prefijo
│   │   ├── request.ts              # Configuración server-side i18n
│   │   └── navigation.ts           # Link, useRouter, usePathname localizados
│   ├── lib/
│   │   ├── api-client.ts           # Instancia Axios con interceptores JWT
│   │   ├── utils.ts                # Utilidad cn() (clsx + tailwind-merge)
│   │   ├── api/
│   │   │   ├── auth.ts             # Funciones de API de autenticación
│   │   │   ├── addresses.ts        # Funciones de API de direcciones
│   │   │   ├── cart.ts             # Funciones de API del carrito + gestión de sesión
│   │   │   ├── communication-preferences.ts  # Funciones de API de preferencias
│   │   │   ├── orders.ts           # Funciones de API de pedidos
│   │   │   └── products.ts         # Funciones de API de productos
│   │   └── validations/
│   │       └── auth.ts             # Esquemas Zod para formularios auth
│   ├── middleware.ts               # Middleware next-intl (detección de locale)
│   ├── stores/
│   │   ├── auth-store.ts           # Store Zustand de autenticación
│   │   └── cart-store.ts           # Store Zustand del carrito (persist + optimistic updates)
│   └── types/
│       ├── auth.ts                 # Tipos TypeScript (DTOs auth, store)
│       ├── addresses.ts            # Tipos TypeScript (DTOs direcciones)
│       ├── cart.ts                 # Tipos TypeScript (DTOs carrito)
│       ├── communication-preferences.ts  # Tipos TypeScript (DTOs preferencias)
│       ├── orders.ts               # Tipos TypeScript (DTOs pedidos)
│       └── products.ts             # Tipos TypeScript (DTOs productos)
├── tests/
│   ├── setup.ts                    # Configuración Vitest (jest-dom, mocks)
│   ├── helpers/
│   │   ├── render.tsx              # Custom render con NextIntlClientProvider
│   │   └── auth-store.ts           # Helpers de reset y mock del store
│   ├── unit/                       # Tests unitarios (validaciones, store, API)
│   │   └── lib/
│   │       └── api/
│   │           └── communication-preferences.test.ts
│   ├── components/
│   │   ├── auth/                   # Tests de componentes de autenticación
│   │   ├── home/                   # Tests de componentes de home
│   │   ├── layout/                 # Tests de componentes de layout
│   │   ├── products/               # Tests de componentes de productos
│   │   ├── private-area/           # Tests de componentes de área privada
│   │   │   ├── ProfileContent.test.tsx
│   │   │   ├── SettingsContent.test.tsx
│   │   │   ├── EditUserModal.test.tsx
│   │   │   ├── BillingAddressCard.test.tsx
│   │   │   ├── DeliveryAddressCard.test.tsx
│   │   │   ├── AddBillingAddressModal.test.tsx
│   │   │   ├── AddDeliveryAddressModal.test.tsx
│   │   │   └── orders/
│   │   │       ├── OrdersContent.test.tsx
│   │   │       └── OrderDetailContent.test.tsx
│   │   └── ui/                     # Tests de componentes UI
│   │       ├── Modal.test.tsx
│   │       └── Switch.test.tsx
│   └── e2e/                        # Tests E2E (Playwright)
├── next.config.ts                  # Configuración Next.js + plugin next-intl
├── playwright.config.ts            # Configuración Playwright
├── tsconfig.json                   # TypeScript (alias @/*, excluye tests)
└── package.json
```

### Características de Seguridad

- **Renovación automática de tokens**: Interceptor Axios detecta respuestas 401 y renueva el JWT usando el refresh token, con cola de peticiones concurrentes para evitar múltiples refreshes simultáneos.
- **Protección de rutas auth**: `AuthRedirectGuard` redirige usuarios autenticados fuera de las páginas de login/registro.
- **Validación dual**: Validación en cliente (Zod) y servidor (ASP.NET Identity) con mensajes de error localizados.
- **Almacenamiento persistente**: Tokens y estado de autenticación persistidos en `localStorage` vía Zustand `persist` middleware.
- **Limpieza de sesión**: Logout limpia el estado local independientemente de la respuesta del servidor.
- **Prevención de enumeración**: La página de forgot-password siempre muestra éxito, sin revelar si el email existe.

---

## Esquema de Navegación

### Mapa de Rutas

```
/                                    → Redirect a /{defaultLocale}
│
├── /es                              → Home (español)
├── /en                              → Home (inglés)
│
├── /{locale}/login                  → Inicio de sesión
├── /{locale}/register               → Registro
├── /{locale}/forgot-password        → Solicitar restablecimiento de contraseña
├── /{locale}/reset-password         → Restablecer contraseña (?email=...&token=...)
│
├── /{locale}/perfil                 → Perfil de usuario (requiere autenticación)
├── /{locale}/configuracion          → Configuraciones de usuario (requiere autenticación)
├── /{locale}/pedidos                → Listado de pedidos (requiere autenticación)
├── /{locale}/pedidos/{id}           → Detalle de pedido (requiere autenticación)
│
├── /{locale}/productos              → Listado de productos (paginado, filtros)
├── /{locale}/productos/{slug}       → Detalle de producto (dinámico, SSR)
└── /{locale}/carrito                → Carrito de compra (pública, anónimos y autenticados)
```

### Internacionalización (i18n)

- **Locales soportados**: `es` (español, por defecto), `en` (inglés).
- **Estrategia de prefijo**: `always` — todas las URLs incluyen el prefijo de locale.
- **Middleware**: Intercepta todas las peticiones (excepto `/api`, `/_next`, y archivos estáticos) para detectar el locale y redirigir si es necesario.
- **Archivos de mensajes**: `messages/es.json` y `messages/en.json` con claves organizadas por sección (`common`, `auth`, `home`, `products`, `productDetail`, `nav`).

### Flujo de Navegación

```mermaid
flowchart TD
    A["/ (raíz)"] -->|redirect| B["/{locale} (Home)"]

    B -->|no autenticado| C["Botón Sign In"]
    B -->|no autenticado| D["Botón Create Account"]
    B -->|autenticado| E["Botón Log Out"]
    B -->|autenticado| P["Link My Profile"]

    C --> F["/{locale}/login"]
    D --> G["/{locale}/register"]

    F -->|login exitoso| B
    G -->|registro exitoso| B
    E -->|logout| B

    F -->|"Forgot password?"| H["/{locale}/forgot-password"]
    F -->|"Create one"| G
    G -->|"Sign In"| F

    H -->|envío exitoso| I["Estado: Check Your Email"]
    I -->|"Try a different email"| H
    I -->|email con enlace| J["/{locale}/reset-password?email=...&token=..."]

    J -->|reset exitoso| K["Estado: Password Reset Complete"]
    K -->|"SIGN IN NOW"| F

    J -->|token inválido| L["Estado: Token inválido"]
    L -->|"Request new link"| H

    P --> O["/{locale}/perfil"]
    O -->|"Log Out"| B

    B -->|"Explorar Productos"| M["/{locale}/productos"]
    M -->|click en producto| N["/{locale}/productos/{slug}"]
    N -->|breadcrumb "Productos"| M
    N -->|breadcrumb "Inicio"| B
```

### Layouts y Grupos de Rutas

```
Root Layout (layout.tsx)
│   → Fuentes Geist Sans/Mono, tema dark, metadata global
│
└── [locale] Layout (layout.tsx)
    │   → Validación de locale, NextIntlClientProvider
    │
    ├── Home Page (page.tsx + HomeContent.tsx)
    │   → Contenido condicional según autenticación
    │
    ├── (auth) Group Layout (layout.tsx)
    │   │   → AuthRedirectGuard + AuthLayout (centrado full-screen)
    │   │
    │   ├── /login          → AuthCard + LoginForm
    │   ├── /register       → AuthCard + RegisterForm
    │   ├── /forgot-password → AuthCard + ForgotPasswordForm
    │   └── /reset-password → AuthCard + ResetPasswordForm
    │
    ├── (private-area)
    │   ├── Layout (PrivateAreaGuard + PrivateAreaLayout)
    │   │   → Protección de autenticación + navegación lateral
    │   │
    │   ├── /perfil         → ProfileContent
    │   │   → Información personal, direcciones de facturación y envío
    │   │
    │   ├── /configuracion  → SettingsContent
    │   │   → Preferencias de comunicación, seguridad y zona peligro
    │   │
    │   └── /pedidos
    │       ├── (page)      → OrdersContent
    │       │   → Listado de pedidos con filtros por estado
    │       │
    │       └── /[id]       → OrderDetailContent
    │           → Detalle del pedido: timeline, productos, resumen y dirección
    │
    ├── /carrito (page.tsx + CartContent.tsx)
    │   → Carrito de compra: items, selector de cantidad, resumen de orden
    │
    └── /productos
        ├── Listado (page.tsx + ProductsPageContent.tsx)
        │   → Grid de productos con filtros, búsqueda y paginación
        │
        └── /[slug] (page.tsx + ProductDetailContent.tsx)
            → Detalle de producto con galería, info, specs y JSON-LD
```

El grupo `(auth)` es un **Route Group** de Next.js: agrupa las páginas de autenticación bajo un layout común sin añadir un segmento a la URL. Todas las páginas dentro comparten:
1. **`AuthRedirectGuard`**: Si el usuario está autenticado, redirige a `/`.
2. **`AuthLayout`**: Layout full-screen con fondo oscuro que centra el contenido.

El grupo `(private-area)` sigue el mismo patrón: agrupa las páginas del área privada bajo un layout compartido sin añadir `/private-area` a la URL. Todas las páginas dentro comparten:
1. **`PrivateAreaGuard`**: Si el usuario no está autenticado tras la hidratación del store, redirige a `/login` con un pequeño delay para permitir el refresco de token.
2. **`PrivateAreaLayout`**: Layout con sidebar de navegación lateral.

---

## Descripción de Páginas y Componentes

### Páginas

#### Home (`/{locale}`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/page.tsx` + `HomeContent.tsx` |
| Tipo | Server Component (wrapper) + Client Component (contenido) |
| Autenticación | No requerida |

**Descripción**: Página principal de la aplicación. El server component establece el locale y delega al client component `HomeContent`, que lee el estado de autenticación del store Zustand.

**Comportamiento condicional**:
- **No autenticado**: Muestra el logo "SIMRACING**SHOP**", el tagline, y dos botones: "Sign In" (fondo rojo) y "Create Account" (borde blanco).
- **Autenticado**: Muestra "Welcome, {nombre}" y un botón "Log Out" que llama a `authApi.logout()` y limpia el store.

---

#### Login (`/{locale}/login`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/(auth)/login/page.tsx` |
| Tipo | Server Component + Client Component (`LoginForm`) |
| Autenticación | Redirige a home si ya autenticado |

**Descripción**: Página de inicio de sesión envuelta en `AuthCard` con título "Welcome Back" y subtítulo "Sign in to your account".

**Formulario** (`LoginForm`):

| Campo | Tipo | Validación |
|-------|------|------------|
| Email | `<Input>` | Requerido, formato email válido |
| Password | `<PasswordInput>` | Requerido |
| Remember me | `<Checkbox>` | Opcional (default: false) |

**Acciones**:
- **Submit ("SIGN IN")**: Llama `authApi.login()`, almacena tokens en store, redirige a `/`.
- **"Forgot password?"**: Enlace a `/forgot-password`.
- **"Create one"**: Enlace a `/register`.

**Errores**:

| Código HTTP | Mensaje mostrado |
|-------------|------------------|
| 401 | "Invalid email or password. Please try again." |
| 423 | "Account temporarily locked. Please try again later." |
| 403 | "Please verify your email before signing in." |
| Otro | "Could not sign in. Please try again." |

---

#### Register (`/{locale}/register`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/(auth)/register/page.tsx` |
| Tipo | Server Component + Client Component (`RegisterForm`) |
| Autenticación | Redirige a home si ya autenticado |

**Descripción**: Página de registro envuelta en `AuthCard` con título "Create Account" y un enlace "Sign In" en el subtítulo.

**Formulario** (`RegisterForm`):

| Campo | Tipo | Validación |
|-------|------|------------|
| First Name | `<Input>` | Opcional |
| Last Name | `<Input>` | Opcional |
| Email | `<Input>` | Requerido, formato email válido |
| Password | `<PasswordInput>` | Requerido, min 8 chars, mayúscula, minúscula, dígito |
| Confirm Password | `<PasswordInput>` | Requerido, debe coincidir con Password |
| Accept Terms | `<Checkbox>` | Requerido (debe ser true) |
| Newsletter | `<Checkbox>` | Opcional |

**Características**:
- Los campos First Name y Last Name se muestran en grid de 2 columnas.
- Al escribir en el campo Password, se muestra el componente `PasswordRequirements` con indicadores en tiempo real.
- El envío incluye el `locale` actual como parámetro `language` para la API.

**Errores**:

| Código HTTP | Mensaje mostrado |
|-------------|------------------|
| 409 | "This email is already registered." |
| Otro | "Could not create account. Please try again." |

---

#### Forgot Password (`/{locale}/forgot-password`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/(auth)/forgot-password/page.tsx` |
| Tipo | Server Component + Client Component (`ForgotPasswordForm`) |
| Autenticación | Redirige a home si ya autenticado |

**Descripción**: Página de solicitud de restablecimiento de contraseña. Componente con dos estados internos.

**Estado: Formulario**

| Campo | Tipo | Validación |
|-------|------|------------|
| Email | `<Input>` | Requerido, formato email válido |

- **Submit ("SEND RESET LINK")**: Llama `authApi.forgotPassword()`, transiciona al estado success.
- **"Back to Sign In"**: Enlace a `/login`.

**Estado: Success ("Check Your Email")**

- Muestra icono de correo verde y el email al que se envió el enlace.
- **Botón "Resend Email"**: Deshabilitado durante un cooldown de 60 segundos con cuenta regresiva visible ("Resend in {n}s"). Se habilita al expirar el temporizador.
- **"Try a different email"**: Vuelve al estado formulario.

**Errores**:

| Escenario | Mensaje mostrado |
|-----------|------------------|
| Error de red/API | "Could not send email. Please try again." |

---

#### Reset Password (`/{locale}/reset-password`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/(auth)/reset-password/page.tsx` + `ResetPasswordContent.tsx` |
| Tipo | Server Component + Client Component con `useSearchParams()` |
| Autenticación | Redirige a home si ya autenticado |
| Parámetros URL | `?email={email}&token={token}` |

**Descripción**: Página de restablecimiento de contraseña. Envuelta en `Suspense` porque usa `useSearchParams()`. Si faltan los parámetros `email` o `token` en la URL, muestra directamente el estado de token inválido.

**Estado: Formulario** (`ResetPasswordForm`)

| Campo | Tipo | Validación |
|-------|------|------------|
| New Password | `<PasswordInput>` | Requerido, min 8 chars, mayúscula, minúscula, dígito |
| Confirm Password | `<PasswordInput>` | Requerido, debe coincidir con New Password |

- Muestra `PasswordRequirements` en tiempo real al escribir la contraseña.
- **Submit ("RESET PASSWORD")**: Llama `authApi.resetPassword()` con email, token, newPassword y confirmPassword.

**Estado: Success ("Password Reset Complete")**

- Muestra icono de check verde y mensaje de éxito.
- **"SIGN IN NOW"**: Enlace a `/login`.

**Estado: Token Inválido**

- Muestra icono X rojo y mensaje de token inválido o expirado.
- **"Request new link"**: Enlace a `/forgot-password`.

**Errores**:

| Código HTTP | Estado resultante |
|-------------|-------------------|
| 400/404 | Transiciona al estado "Token Inválido" |
| Otro | Muestra mensaje genérico en el formulario |

---

#### Perfil de Usuario (`/{locale}/perfil`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/(private-area)/perfil/page.tsx` |
| Tipo | Server Component + Client Component (`ProfileContent`) |
| Autenticación | Requerida (protegida por `PrivateAreaGuard`) |

**Descripción**: Página de perfil de usuario que permite gestionar información personal, dirección de facturación y direcciones de envío. El server component establece el locale y delega al client component `ProfileContent`.

**Layout**: Usa `PrivateAreaGuard` + `PrivateAreaLayout` que proporciona protección de autenticación y un sidebar de navegación. Si el usuario no está autenticado, `PrivateAreaGuard` redirige a `/login`.

**Secciones del perfil**:

1. **Header**:
   - Título: "My Profile"
   - Descripción: "Manage your personal information and preferences"

2. **Stats Cards** (grid de 4 tarjetas):
   - Total Orders: Muestra 0 (placeholder)
   - Total Spent: Muestra €0 (placeholder)
   - Favorite Products: Muestra 0 (placeholder)
   - Member Level: Muestra "Basic" (placeholder)

3. **Personal Information**:
   - Nombre completo (firstName + lastName o "Not provided")
   - Email
   - Idioma (en mayúsculas)
   - Estado de verificación de email ("Verified" en verde o "Not verified" en gris)
   - Botón de edición (icono lápiz) que abre `EditUserModal`

4. **Billing Address**:
   - Si existe: Muestra `BillingAddressCard` con dirección completa y botón de edición
   - Si no existe: Mensaje "You don't have a billing address registered" + botón "Add billing address"
   - Modal `AddBillingAddressModal` para crear/editar dirección de facturación

5. **Delivery Addresses**:
   - Si existen: Grid responsivo de `DeliveryAddressCard` con botones de edición y eliminación
   - Si no existe: Mensaje "You don't have any delivery addresses registered"
   - Botón "Add delivery address" siempre visible cuando hay direcciones
   - Modal `AddDeliveryAddressModal` para crear/editar direcciones de envío
   - Badge "Default" en la dirección marcada como predeterminada
   - Confirmación de eliminación con diálogo modal

**Estados**:
- **Loading**: Muestra "Loading profile..." mientras se obtienen los datos
- **Error**: Mensaje de error si falla la carga de datos
- **No user data**: Mensaje "Could not load user information"

**Endpoints API**:
- `GET /auth/me` → Obtiene datos del usuario actual
- `GET /api/user/billing-address` → Obtiene dirección de facturación
- `GET /api/user/delivery-addresses` → Obtiene todas las direcciones de envío
- `POST /api/user/billing-address` → Crea dirección de facturación
- `PUT /api/user/billing-address` → Actualiza dirección de facturación
- `POST /api/user/delivery-addresses` → Crea dirección de envío
- `PUT /api/user/delivery-addresses/{id}` → Actualiza dirección de envío
- `DELETE /api/user/delivery-addresses/{id}` → Elimina dirección de envío
- `PUT /user` → Actualiza información personal del usuario

**Comportamiento**:
- Los datos se recargan automáticamente al crear, actualizar o eliminar direcciones
- Los modales se cierran automáticamente después de una operación exitosa
- Los errores se muestran dentro de los modales correspondientes

---

#### Configuraciones de Usuario (`/{locale}/configuracion`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/(private-area)/configuracion/page.tsx` |
| Tipo | Server Component + Client Component (`SettingsContent`) |
| Autenticación | Requerida (protegida por `PrivateAreaGuard`) |

**Descripción**: Página de configuraciones del usuario que permite gestionar preferencias de comunicación, seguridad de la cuenta y acciones peligrosas como la eliminación de cuenta. El server component establece el locale y delega al client component `SettingsContent`.

**Layout**: Usa `PrivateAreaGuard` + `PrivateAreaLayout` que proporciona protección de autenticación y un sidebar de navegación. Si el usuario no está autenticado, `PrivateAreaGuard` redirige a `/login`.

**Secciones de configuraciones**:

1. **Header**:
   - Título: "Settings"
   - Descripción: "Manage your account settings and preferences"

2. **Communication Preferences**:
   - Gestión de preferencias de comunicación con 3 toggles:
     - **Newsletter**: Suscripción a newsletters y novedades
     - **Order Notifications**: Notificaciones sobre estado de pedidos
     - **SMS Promotions**: Recepción de ofertas por SMS
   - Cada toggle usa el componente `Switch` con feedback visual (rojo cuando activo, gris cuando inactivo)
   - Actualización inmediata al cambiar un toggle con llamada API
   - Mensajes de éxito/error después de actualizar
   - Estado de carga mientras se obtienen las preferencias iniciales

3. **Security**:
   - Sección para gestionar la seguridad de la cuenta
   - Botón "SEND PASSWORD CHANGE EMAIL" que envía un correo de restablecimiento de contraseña
   - Usa el mismo flujo que forgot-password (envía email al usuario actual)
   - Mensajes de éxito/error después del envío
   - Estado de carga durante el proceso

4. **Danger Zone**:
   - Sección destacada con borde rojo para acciones peligrosas
   - Botón "DELETE ACCOUNT" que abre un modal de confirmación
   - **Modal de confirmación**:
     - Advertencia sobre la permanencia de la acción
     - Lista de consecuencias (pérdida de datos, pedidos, direcciones)
     - Campo de confirmación: Usuario debe escribir su email exactamente
     - Botón de confirmación deshabilitado hasta que el email coincida
     - Validación de email antes de proceder
     - Al confirmar: Elimina la cuenta, cierra sesión y redirige a home
   - Mensajes de error si la eliminación falla

**Estados**:
- **Loading**: Muestra spinner mientras se cargan las preferencias iniciales
- **Error**: Mensaje de error si falla la carga de preferencias
- **Saving**: Indicador visual en los toggles mientras se guarda
- **Success**: Mensajes de confirmación con checkmark verde
- **Error states**: Alertas rojas con icono de advertencia

**Endpoints API**:
- `GET /communication-preferences` → Obtiene preferencias de comunicación del usuario
- `PUT /communication-preferences` → Actualiza preferencias de comunicación
- `POST /auth/forgot-password` → Envía email de restablecimiento de contraseña
- `DELETE /user` → Elimina la cuenta del usuario

**Comportamiento**:
- Las preferencias se cargan automáticamente al montar el componente
- Los cambios en toggles se guardan inmediatamente sin botón de submit
- Los mensajes de éxito desaparecen automáticamente después de 3-5 segundos
- El modal de eliminación se cierra al cancelar o después de una eliminación exitosa
- Validación estricta del email antes de permitir la eliminación de cuenta

---

#### Mis Pedidos (`/{locale}/pedidos`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/(private-area)/pedidos/page.tsx` |
| Tipo | Server Component (wrapper con `generateMetadata`) + Client Component (`OrdersContent`) |
| Autenticación | Requerida (protegida por `PrivateAreaGuard`) |

**Descripción**: Página de listado de pedidos del usuario. El server component genera metadata i18n (`Orders` namespace) y delega al client component `OrdersContent`, que carga y filtra los pedidos del usuario autenticado.

**Funcionalidades**:
- **Filtros por estado**: Chips de filtrado rápido para todos los estados posibles (`all`, `pending`, `processing`, `shipped`, `delivered`, `cancelled`). El chip activo se resalta en `racing-red`.
- **Lista de pedidos**: Renderiza un `OrderCard` por cada pedido que coincida con el filtro activo.
- **Estado vacío global**: Si el usuario no tiene pedidos, muestra un icono `ShoppingBag` con mensaje y un botón de acceso al catálogo.
- **Estado vacío por filtro**: Si no hay pedidos con el filtro activo, muestra mensaje y enlace para ver todos.
- **Reintento**: En caso de error de carga, botón "Reintentar" que vuelve a disparar la petición.

**Estados**:
- **Loading**: 3 skeletons animados con estructura similar a `OrderCard`.
- **Error**: Mensaje de error con botón de reintento.
- **Sin pedidos**: Ilustración vacía con CTA a la tienda.
- **Éxito**: Grid de `OrderCard` con filtros activos.

**Endpoint API**: `GET /orders` → `OrderSummaryDto[]`.

---

#### Detalle de Pedido (`/{locale}/pedidos/{id}`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/(private-area)/pedidos/[id]/page.tsx` |
| Tipo | Server Component (con `generateMetadata`) + Client Component (`OrderDetailContent`) |
| Autenticación | Requerida (protegida por `PrivateAreaGuard`) |
| Parámetros URL | `{id}` — ID del pedido |

**Descripción**: Página de detalle de un pedido concreto. El server component genera metadata dinámica con el número de pedido y delega al client component `OrderDetailContent`, que carga el pedido por ID y compone todas las secciones.

**Layout**:
```
┌─────────────────────────────────────────────────────┐
│  Breadcrumb (← Mis Pedidos / #ORD-XXXX)             │
├─────────────────────────────────────────────────────┤
│  Header: número de pedido, fecha, estado, total     │
│  (+ días de producción estimados si en processing)  │
├─────────────────────────────────────────────────────┤
│  Timeline de seguimiento (4 pasos)                  │
│  └─ Número de tracking (si existe) con botón copiar │
├──────────────────────────────┬──────────────────────┤
│  Líneas de pedido            │  Dirección de envío  │
│  (producto, SKU, config,     ├──────────────────────┤
│   cantidad, precio)          │  Resumen de importes │
│  + Notas del pedido          │  (subtotal, envío,   │
│                              │   IVA, total)        │
│                              ├──────────────────────┤
│                              │  Notas de producción │
│                              │  (si existen)        │
├──────────────────────────────┴──────────────────────┤
│  Sección de ayuda (email de soporte, devoluciones)  │
└─────────────────────────────────────────────────────┘
```

**Timeline de seguimiento**: Muestra 4 pasos (Confirmado, En proceso, Enviado, Entregado) con iconos y líneas de conexión. Cada paso puede estar en estado `completed` (verde), `current` (rojo + pulso) o `pending` (gris). Si el pedido está `cancelled`, el timeline se reemplaza por un mensaje de cancelación en rojo.

**Número de tracking**: Si `trackingNumber` existe, se muestra en fuente monoespaciada con botón "Copiar" que copia al portapapeles y cambia su texto a "Copiado" durante 2 segundos.

**Líneas de pedido**: Cada línea muestra SKU, nombre del producto, configuración (si `configurationJson` no es nulo, se parsea y muestra como pares clave-valor separados por `•`), cantidad y precio total de línea.

**Estados**:
- **Loading**: Skeleton animado respetando la estructura de cards del layout.
- **Not found (404)**: Mensaje con botón de regreso al listado.
- **Error**: Mensaje de error con botón de reintento.
- **Éxito**: Layout completo con todas las secciones.

**Endpoint API**: `GET /orders/{id}` → `OrderDetailDto`.

---

#### Listado de Productos (`/{locale}/productos`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/productos/page.tsx` + `ProductsPageContent.tsx` |
| Tipo | Server Component (wrapper) + Client Component (contenido) |
| Autenticación | No requerida |

**Descripción**: Página de catálogo que muestra todos los productos activos. El server component establece el locale y delega al client component `ProductsPageContent`, que gestiona filtros, búsqueda, ordenamiento y paginación.

**Funcionalidades**:
- **Búsqueda**: Campo de texto con debounce de 300ms.
- **Filtros**: Rango de precio (min/max), solo personalizables.
- **Ordenamiento**: Destacados, precio ascendente/descendente, más recientes, nombre.
- **Paginación**: 12 productos por página con navegación previa/siguiente.
- **Estado en URL**: Todos los filtros se sincronizan con los query params de la URL.

**Componentes utilizados**: `ProductGrid`, `ProductFilters`, `Pagination`, `ProductCard`.

**Endpoint API**: `GET /api/products` con parámetros `Page`, `PageSize`, `Locale`, `Search`, `MinPrice`, `MaxPrice`, `IsCustomizable`, `SortBy`, `SortDescending`.

---

#### Detalle de Producto (`/{locale}/productos/{slug}`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/productos/[slug]/page.tsx` + `ProductDetailContent.tsx` |
| Tipo | Server Component (wrapper con `generateMetadata`) + Client Component |
| Autenticación | No requerida |
| Renderizado | Dinámico (server-rendered on demand) |

**Descripción**: Página de detalle de producto (PDP). El server component genera metadata SEO (título, descripción, Open Graph) llamando al API server-side. El client component `ProductDetailContent` realiza el fetch del producto y compone las secciones.

**Layout**:
```
Desktop (≥1024px): Grid 2 columnas [55% | 45%]
Mobile  (<1024px): 1 columna (galería arriba, info abajo)

┌──────────────────────────┬──────────────────────┐
│  ProductImageGallery     │  ProductInfo          │
│  • Imagen principal      │  • Breadcrumb         │
│  • Thumbnails            │  • Nombre (h1)        │
│                          │  • SKU + badge        │
│                          │  • Precio con IVA     │
│                          │  • Estado de stock    │
│                          │  • Descripción corta  │
│                          │  • Botón PERSONALIZAR │
│                          │  • Trust indicators   │
├──────────────────────────┴──────────────────────┤
│  ProductSpecifications                           │
│  • Tabla de especificaciones técnicas            │
├──────────────────────────────────────────────────┤
│  Descripción larga (si existe)                   │
└──────────────────────────────────────────────────┘
```

**SEO**:
- `generateMetadata`: Usa `metaTitle`, `metaDescription` del producto para `<title>` y OG tags.
- `ProductJsonLd`: Inyecta schema.org/Product con nombre, descripción, SKU, imágenes, oferta (precio EUR, disponibilidad).

**Estados**:
- **Loading**: Skeleton loader animado (`animate-pulse`) respetando el layout 2 columnas.
- **Error/404**: Mensaje de error centrado con botón "Reintentar".
- **Éxito**: Layout completo con todas las secciones.

**Endpoint API**: `GET /api/products/slug/{slug}?Locale={locale}` → `ProductDetailDto`.

---

#### Carrito (`/{locale}/carrito`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/carrito/page.tsx` + `CartContent.tsx` |
| Tipo | Server Component (wrapper con `generateMetadata`) + Client Component (contenido) |
| Autenticación | No requerida (accesible para usuarios anónimos y autenticados) |

**Descripción**: Página del carrito de compra. El server component genera metadata i18n (namespace `Cart`) con título y descripción de página, y delega al client component `CartContent`.

**Layout**:
```
Desktop (≥1024px): Grid 2 columnas [1fr | 400px]
Mobile  (<1024px): 1 columna (items arriba, resumen abajo)

┌──────────────────────────────────┬──────────────┐
│  Breadcrumb (Inicio / Carrito)   │              │
├──────────────────────────────────┤              │
│  h1: Título del carrito          │              │
├──────────────────────────────────┤ CartSummary  │
│  Items (bg-carbon)               │  (sticky)    │
│  ├─ Header: "X artículos"        │              │
│  │   + botón Vaciar carrito      │              │
│  └─ Lista de CartItemRow         │              │
└──────────────────────────────────┴──────────────┘
```

**Comportamiento condicional**:
- **Loading** (primera carga): Grid skeleton con 2 placeholders animados (`animate-pulse`) en la columna de items y uno en el panel de resumen.
- **Carrito vacío**: Estado centered con icono `ShoppingCart`, título, mensaje y botón CTA "Explorar Productos" que enlaza a `/productos`.
- **Con items**: Layout de dos columnas con la lista de `CartItemRow` y el `CartSummary` sticky.

**Flujo de datos**:
1. Al montar, espera la hidratación del store Zustand (`_hasHydrated`).
2. Llama `fetchCart(locale)` para cargar el carrito desde la API.
3. Todas las operaciones posteriores (actualizar cantidad, eliminar item, vaciar) se ejecutan a través del store con actualización optimista.

**Acciones disponibles**:
- **Vaciar carrito** (`clearCart`): Botón con icono `Trash2` en el header de la sección de items. Deshabilitado durante `isLoading`.
- **Actualizar cantidad** (`updateItem`): Delegado a cada `CartItemRow` → `QuantitySelector`.
- **Eliminar item** (`removeItem`): Delegado a cada `CartItemRow`.
- **Ir al checkout**: Delegado a `CartSummary`.

**Endpoints API** (vía `cart-store`):
- `GET /cart` → `CartDto`
- `PUT /cart/items/{productId}` → `CartDto`
- `DELETE /cart/items/{productId}`
- `DELETE /cart`

---

### Componentes

#### AuthCard

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/AuthCard.tsx` |
| Tipo | Client Component |

**Descripción**: Contenedor visual compartido por todas las páginas de autenticación. Renderiza una tarjeta con fondo `carbon`, borde `graphite` y ancho máximo de 420px.

**Props**:

| Prop | Tipo | Default | Descripción |
|------|------|---------|-------------|
| `title` | `string` | — | Título principal (renderizado como `<h1>`) |
| `subtitle` | `ReactNode` | — | Subtítulo opcional debajo del título |
| `showLogo` | `boolean` | `true` | Muestra el logo "SIMRACING**SHOP**" con enlace a home |
| `children` | `ReactNode` | — | Contenido del formulario |

---

#### AuthLayout

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/AuthLayout.tsx` |
| Tipo | Client Component |

**Descripción**: Layout full-screen con fondo `obsidian` que centra su contenido vertical y horizontalmente. Opcionalmente incluye un panel lateral de marca visible solo en pantallas `lg:` y superiores.

**Props**:

| Prop | Tipo | Default | Descripción |
|------|------|---------|-------------|
| `children` | `ReactNode` | — | Contenido principal (el AuthCard) |
| `showBrandPanel` | `boolean` | `false` | Muestra panel lateral con imagen de fondo |
| `brandContent` | `ReactNode` | — | Contenido del panel lateral |

---

#### AuthRedirectGuard

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/AuthRedirectGuard.tsx` |
| Tipo | Client Component |

**Descripción**: Guarda de protección que impide a usuarios autenticados acceder a las páginas de auth. Lee `isAuthenticated` del store Zustand y, si es `true`, ejecuta `router.replace("/")` y renderiza `null`. Si es `false`, renderiza los `children` normalmente.

---

#### LoginForm

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/LoginForm.tsx` |
| Tipo | Client Component |

**Descripción**: Formulario de inicio de sesión con validación Zod integrada a React Hook Form. Gestiona el flujo completo: validación → llamada API → almacenamiento de tokens → redirección.

**Esquema de validación** (`createLoginSchema`):
- `email`: Requerido, formato email válido.
- `password`: Requerido.
- `rememberMe`: Booleano opcional.

**Flujo de submit**:
1. Valida los campos con el esquema Zod.
2. Llama `authApi.login({ email, password, rememberMe })`.
3. En éxito: `useAuthStore.setAuth(response)` + `router.push("/")`.
4. En error: Mapea el código HTTP al mensaje i18n correspondiente y lo muestra como alerta.

---

#### RegisterForm

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/RegisterForm.tsx` |
| Tipo | Client Component |

**Descripción**: Formulario de registro con 7 campos, validación de fortaleza de contraseña en tiempo real, y requisitos visuales. El formulario más complejo de la aplicación.

**Esquema de validación** (`createRegisterSchema`):
- `firstName`, `lastName`: Opcionales.
- `email`: Requerido, formato válido.
- `password`: Requerido, min 8 chars, al menos una mayúscula, una minúscula y un dígito.
- `confirmPassword`: Debe coincidir con `password` (refinamiento Zod).
- `acceptTerms`: Debe ser `true`.
- `newsletter`: Booleano opcional.

**Flujo de submit**:
1. Valida los campos con el esquema Zod.
2. Llama `authApi.register({ ...data, language: locale })`.
3. En éxito: `useAuthStore.setAuth(response)` + `router.push("/")`.
4. En error: Mapea 409 a "email ya registrado", otros a mensaje genérico.

**Característica especial**: El componente `PasswordRequirements` se muestra condicionalmente cuando el campo password tiene contenido, proporcionando feedback visual en tiempo real.

---

#### ForgotPasswordForm

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/ForgotPasswordForm.tsx` |
| Tipo | Client Component |

**Descripción**: Componente con máquina de estados que gestiona dos vistas: el formulario de solicitud y el estado de confirmación con temporizador de reenvío.

**Estados internos**:
- `submitted: boolean` — Controla qué vista se muestra.
- `sentEmail: string` — Email enviado (para mostrarlo en la confirmación).
- `cooldown: number` — Cuenta regresiva en segundos (inicia en 60).

**Esquema de validación** (`createForgotPasswordSchema`):
- `email`: Requerido, formato válido.

**Temporizador de reenvío**: Implementado con `setInterval` que decrementa `cooldown` cada segundo. Al llegar a 0, el botón "Resend Email" se habilita. Al reenviar, el cooldown se reinicia a 60.

---

#### ResetPasswordForm

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/ResetPasswordForm.tsx` |
| Tipo | Client Component |

**Descripción**: Componente con tres estados posibles que gestiona el restablecimiento de contraseña usando el token recibido por email.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `email` | `string` | Email del usuario (de los query params) |
| `token` | `string` | Token de restablecimiento (de los query params) |

**Estados internos**: `"form"` | `"success"` | `"invalidToken"`.

**Esquema de validación** (`createResetPasswordSchema`):
- `newPassword`: Requerido, min 8 chars, mayúscula, minúscula, dígito.
- `confirmPassword`: Debe coincidir con `newPassword`.

**Flujo de submit**:
1. Valida los campos con el esquema Zod.
2. Llama `authApi.resetPassword({ email, token, newPassword, confirmPassword })`.
3. En éxito: Transiciona al estado `"success"`.
4. En error 400/404: Transiciona al estado `"invalidToken"`.
5. En otro error: Muestra mensaje genérico en el formulario.

---

#### PasswordInput

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/PasswordInput.tsx` |
| Tipo | Client Component (`forwardRef`) |

**Descripción**: Campo de contraseña con botón de toggle para mostrar/ocultar el texto. Usa `forwardRef` para compatibilidad con `react-hook-form`.

**Props**: Extiende `React.InputHTMLAttributes<HTMLInputElement>` con:

| Prop | Tipo | Default | Descripción |
|------|------|---------|-------------|
| `showLabel` | `string` | `"Show"` | Texto sr-only cuando la contraseña está oculta |
| `hideLabel` | `string` | `"Hide"` | Texto sr-only cuando la contraseña es visible |

**Comportamiento**: Alterna entre `type="password"` y `type="text"`. El botón de toggle tiene `tabIndex={-1}` para no interferir con la navegación por teclado. Incluye iconos `Eye`/`EyeOff` de Lucide React y etiquetas `sr-only` para accesibilidad.

---

#### PasswordRequirements

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/auth/PasswordRequirements.tsx` |
| Tipo | Client Component |

**Descripción**: Indicador visual de fortaleza de contraseña que evalúa 4 requisitos en tiempo real.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `password` | `string` | Valor actual del campo de contraseña |
| `labels` | `object` | Textos i18n para título y cada requisito |

**Requisitos evaluados**:

| Requisito | Regla | Icono cumplido | Icono no cumplido |
|-----------|-------|-----------------|---------------------|
| Longitud mínima | ≥ 8 caracteres | Check (verde) | X (gris) |
| Mayúscula | Al menos una `[A-Z]` | Check (verde) | X (gris) |
| Minúscula | Al menos una `[a-z]` | Check (verde) | X (gris) |
| Número | Al menos un `[0-9]` | Check (verde) | X (gris) |

Usa la función `checkPasswordRequirements()` del módulo de validaciones para evaluar cada regla.

---

#### PrivateAreaGuard

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/private-area/PrivateAreaGuard.tsx` |
| Tipo | Client Component |

**Descripción**: Componente de protección de autenticación para el área privada. Envuelve el layout del grupo de rutas `(private-area)` y redirige a usuarios no autenticados antes de renderizar el contenido protegido.

**Comportamiento**:
- Espera a que el store Zustand se hidrate desde `localStorage` (`_hasHydrated`) antes de evaluar el estado de autenticación.
- Mientras hidrata o si el usuario no está autenticado, muestra una pantalla de carga con el mensaje "Verificando autenticación...".
- Si tras la hidratación `isAuthenticated` es `false`, espera 300ms (para permitir que el interceptor Axios complete un posible refresco de token) y redirige a `/login`.
- Si está autenticado, renderiza los `children` normalmente.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `children` | `ReactNode` | Contenido del área privada |

---

#### PrivateAreaLayout

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/private-area/PrivateAreaLayout.tsx` |
| Tipo | Client Component |

**Descripción**: Layout visual para las páginas del área privada. Proporciona el sidebar de navegación con links a las diferentes secciones. La protección de autenticación es responsabilidad de `PrivateAreaGuard`, que envuelve este componente en el layout del route group.

**Estructura del sidebar**:
- Logo "SIMRACING**SHOP**" con link a home
- Navegación con iconos (User, ShoppingBag, Settings, LogOut)
- Links: Profile (`/perfil`), Orders (`/pedidos`), Settings (`/configuracion`)
- Botón Logout que llama a `authApi.logout()` y redirige a home

**Layout responsivo**:
- Desktop (`≥lg`): Sidebar fijo de 280px a la izquierda, contenido a la derecha
- Mobile (`<lg`): Layout de 1 columna, sidebar arriba del contenido

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `children` | `ReactNode` | Contenido de la página (ej: ProfileContent) |

---

#### ProfileContent

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/private-area/ProfileContent.tsx` |
| Tipo | Client Component |

**Descripción**: Componente principal de la página de perfil que orquesta todas las secciones: información personal, dirección de facturación y direcciones de envío. Gestiona el estado de los modales y la recarga de datos.

**Estado interno**:
- `user`: Datos del usuario actual (UserDto)
- `billingAddress`: Dirección de facturación (BillingAddressDetailDto | null)
- `deliveryAddresses`: Array de direcciones de envío (DeliveryAddressDetailDto[])
- `loading`: Estado de carga inicial
- `error`: Mensaje de error si falla la carga
- `showBillingModal`: Control de visibilidad del modal de facturación
- `showDeliveryModal`: Control de visibilidad del modal de envío
- `showEditUserModal`: Control de visibilidad del modal de edición de usuario
- `editingBillingAddress`: Dirección de facturación en edición
- `editingDeliveryAddress`: Dirección de envío en edición

**Flujo de datos**:
1. Al montar el componente, espera la hidratación del store
2. Realiza 3 llamadas API en paralelo: `getMe()`, `getBillingAddress()`, `getDeliveryAddresses()`
3. Actualiza el estado local y el store Zustand con los datos del usuario
4. En caso de error, muestra mensaje de error

**Handlers**:
- `handleBillingAddressCreated()`: Recarga dirección de facturación después de crear/actualizar
- `handleDeliveryAddressCreated()`: Recarga direcciones de envío después de crear/actualizar
- `handleEditBilling()`: Abre modal en modo edición con datos existentes
- `handleEditDelivery()`: Abre modal en modo edición con datos existentes
- `handleDeleteDelivery()`: Elimina dirección de envío y recarga lista
- `handleUserUpdated()`: Actualiza datos del usuario en estado local y store

---

#### EditUserModal

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/private-area/EditUserModal.tsx` |
| Tipo | Client Component |

**Descripción**: Modal para editar información personal del usuario (firstName, lastName, language). Usa React Hook Form con validación Zod.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `isOpen` | `boolean` | Control de visibilidad del modal |
| `onClose` | `() => void` | Callback para cerrar el modal |
| `user` | `UserDto` | Datos actuales del usuario |
| `onUserUpdated` | `(user: UserDto) => void` | Callback con datos actualizados |

**Formulario**:

| Campo | Tipo | Validación |
|-------|------|------------|
| First Name | `<Input>` | Opcional |
| Last Name | `<Input>` | Opcional |
| Language | `<select>` | Requerido (es/en) |

**Flujo de submit**:
1. Valida los campos con esquema Zod
2. Llama `authApi.updateUser({ firstName, lastName, language })`
3. En éxito: Llama `onUserUpdated()` con los datos actualizados y cierra el modal
4. En error: Muestra mensaje de error dentro del modal

---

#### BillingAddressCard

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/private-area/BillingAddressCard.tsx` |
| Tipo | Client Component |

**Descripción**: Tarjeta visual que muestra la dirección de facturación del usuario con un botón de edición.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `address` | `BillingAddressDetailDto` | Datos de la dirección de facturación |
| `onEdit` | `() => void` | Callback al hacer clic en el botón de edición |

**Visualización**:
- Icono de ubicación (MapPin) en rojo
- Título "Billing address" (traducido)
- Dirección en 3 líneas:
  - Calle
  - Código postal, ciudad, estado
  - País
- Botón de edición (icono lápiz) con hover azul y aria-label para accesibilidad

---

#### DeliveryAddressCard

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/private-area/DeliveryAddressCard.tsx` |
| Tipo | Client Component |

**Descripción**: Tarjeta visual que muestra una dirección de envío con botones de edición y eliminación. Incluye un diálogo de confirmación antes de eliminar.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `address` | `DeliveryAddressDetailDto` | Datos de la dirección de envío |
| `onEdit` | `() => void` | Callback al hacer clic en el botón de edición |
| `onDelete` | `() => void` | Callback al confirmar la eliminación |

**Visualización**:
- Icono de ubicación (MapPin) en rojo
- Nombre de la dirección (ej: "Casa", "Trabajo")
- Badge "Default" en dorado si `isDefault` es true
- Dirección en 3 líneas: calle, código postal + ciudad + estado, país
- Botones de edición (lápiz) y eliminación (papelera) con aria-labels

**Estado interno**:
- `showConfirm`: Control del diálogo de confirmación de eliminación

**Diálogo de confirmación**:
- Título: "Delete address?"
- Mensaje: "This action cannot be undone."
- Botones: "Cancel" (secundario) y "Delete" (primario)
- Se muestra como overlay modal centrado

---

#### AddBillingAddressModal

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/private-area/AddBillingAddressModal.tsx` |
| Tipo | Client Component |

**Descripción**: Modal para crear o editar la dirección de facturación del usuario. Usa React Hook Form con validación Zod para 6 campos.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `isOpen` | `boolean` | Control de visibilidad del modal |
| `onClose` | `() => void` | Callback para cerrar el modal |
| `onSuccess` | `() => void` | Callback cuando la operación es exitosa |
| `editAddress` | `BillingAddressDetailDto \| null` | Si no es null, modal en modo edición |

**Formulario**:

| Campo | Tipo | Validación |
|-------|------|------------|
| Street | `<Input>` | Requerido |
| City | `<Input>` | Requerido |
| State/Province | `<Input>` | Requerido |
| Postal Code | `<Input>` | Requerido |
| Country | `<Input>` | Requerido |

**Flujo de submit**:
- **Modo creación** (`editAddress === null`):
  1. Llama `addressesApi.createBillingAddress(data)`
  2. En éxito: Llama `onSuccess()` y cierra modal
  3. En error: Muestra mensaje de error en el modal

- **Modo edición** (`editAddress !== null`):
  1. Llama `addressesApi.updateBillingAddress({ id, ...data })`
  2. En éxito: Llama `onSuccess()` y cierra modal
  3. En error: Muestra mensaje de error en el modal

**Título del modal**:
- Modo creación: "New Billing Address"
- Modo edición: "Edit Billing Address"

---

#### AddDeliveryAddressModal

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/private-area/AddDeliveryAddressModal.tsx` |
| Tipo | Client Component |

**Descripción**: Modal para crear o editar direcciones de envío del usuario. Similar a `AddBillingAddressModal` pero con campos adicionales (name, isDefault).

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `isOpen` | `boolean` | Control de visibilidad del modal |
| `onClose` | `() => void` | Callback para cerrar el modal |
| `onSuccess` | `() => void` | Callback cuando la operación es exitosa |
| `editAddress` | `DeliveryAddressDetailDto \| null` | Si no es null, modal en modo edición |

**Formulario**:

| Campo | Tipo | Validación |
|-------|------|------------|
| Address Name | `<Input>` | Requerido (ej: "Casa", "Trabajo") |
| Street | `<Input>` | Requerido |
| City | `<Input>` | Requerido |
| State/Province | `<Input>` | Requerido |
| Postal Code | `<Input>` | Requerido |
| Country | `<Input>` | Requerido |
| Set as default | `<Checkbox>` | Opcional (default: true para nueva, preserva valor existente en edición) |

**Flujo de submit**:
- **Modo creación** (`editAddress === null`):
  1. Llama `addressesApi.createDeliveryAddress(data)`
  2. En éxito: Llama `onSuccess()` y cierra modal
  3. En error: Muestra mensaje de error en el modal

- **Modo edición** (`editAddress !== null`):
  1. Llama `addressesApi.updateDeliveryAddress({ id, ...data })`
  2. En éxito: Llama `onSuccess()` y cierra modal
  3. En error: Muestra mensaje de error en el modal

**Título del modal**:
- Modo creación: "New Delivery Address"
- Modo edición: "Edit Delivery Address"

**Características especiales**:
- El checkbox "Set as default" marca la dirección como predeterminada
- En modo creación, el checkbox está marcado por defecto
- En modo edición, el checkbox refleja el valor actual de `isDefault`

---

#### OrdersContent

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/private-area/orders/OrdersContent.tsx` |
| Tipo | Client Component |

**Descripción**: Componente principal de la página de mis pedidos. Carga la lista de pedidos del usuario autenticado, permite filtrar por estado y delega el renderizado de cada pedido a `OrderCard`.

**Estado interno**:
- `orders`: Array de pedidos cargados desde la API (`OrderSummaryDto[]`).
- `fetchStatus`: Estado de la petición (`"loading"` | `"success"` | `"error"`).
- `activeFilter`: Filtro activo (`"all"` | `OrderStatus`).
- `retryCount`: Contador que se incrementa para disparar un reintento de carga.

**Flujo de datos**:
1. Espera la hidratación del store Zustand (`_hasHydrated`).
2. Llama `ordersApi.getOrders()` y almacena el resultado en `orders`.
3. Filtra el array localmente según `activeFilter` (sin nueva llamada a la API).

**Chips de filtro**: Array estático `FILTER_CHIPS` con las opciones `all`, `pending`, `processing`, `shipped`, `delivered`, `cancelled`. Al hacer clic en un chip, se actualiza `activeFilter` y el listado se filtra en el cliente.

**Handlers**:
- `handleRetry()`: Incrementa `retryCount` para provocar una recarga.

**Endpoint API**: `GET /orders` → `OrderSummaryDto[]`.

---

#### OrderDetailContent

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/private-area/orders/OrderDetailContent.tsx` |
| Tipo | Client Component |

**Descripción**: Componente principal de la página de detalle de pedido. Carga un pedido por ID y compone todas las secciones: breadcrumb, header, timeline de seguimiento, líneas de pedido, dirección de envío, resumen económico y sección de ayuda.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `orderId` | `string` | ID del pedido a mostrar (de los parámetros de ruta) |

**Estado interno**:
- `order`: Datos completos del pedido (`OrderDetailDto | null`).
- `fetchStatus`: Estado de la petición (`"loading"` | `"success"` | `"error"` | `"not-found"`).
- `retryCount`: Contador para reintentos.
- `copied`: Indicador temporal de copia del número de tracking.

**Subcomponentes internos**:

| Componente | Descripción |
|------------|-------------|
| `TimelineStepItem` | Paso individual del timeline con icono, línea de conexión, título, descripción y fecha opcional |
| `SummaryRow` | Fila de resumen económico (label + valor), con variante `isTotal` para el total resaltado |
| `LoadingSkeleton` | Skeleton de carga animado que replica la estructura de la página |

**Lógica del timeline**: La función `getTimelineStates(status)` mapea el `OrderStatus` a un array de 4 estados (`completed` | `current` | `pending`) para los pasos Confirmado, En proceso, Enviado, Entregado. El estado `cancelled` pone todos los pasos en `pending` y muestra un bloque de cancelación alternativo.

**Funcionalidad de copia**: `handleCopy()` escribe `order.trackingNumber` en el portapapeles y activa el indicador `copied` durante 2 segundos con `setTimeout`.

**Formateo**:
- Fechas: `Intl.DateTimeFormat` con locale `es-ES` (día, mes, año, hora y minuto).
- Importes: `Intl.NumberFormat` con estilo `currency` y moneda `EUR`.

**Endpoint API**: `GET /orders/{id}` → `OrderDetailDto`.

---

#### OrderCard

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/private-area/orders/OrderCard.tsx` |
| Tipo | Client Component |

**Descripción**: Tarjeta de resumen de pedido para el listado de mis pedidos. Muestra los datos principales del pedido y un enlace al detalle.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `order` | `OrderSummaryDto` | Datos de resumen del pedido |

**Estructura visual**:
```
┌─────────────────────────────────────────────────┐
│ Header: #ORD-XXXX + fecha          [StatusBadge]│
├─────────────────────────────────────────────────┤
│ Items: hasta 3 líneas (nombre + cantidad + €)   │
│        + "y X más" si hay más de 3              │
├─────────────────────────────────────────────────┤
│ Footer: Total: €XXX.XX        [Ver detalles →]  │
└─────────────────────────────────────────────────┘
```

**Características**:
- Muestra un máximo de 3 items (`MAX_VISIBLE_ITEMS = 3`). Si hay más, añade una línea "y {n} más".
- La fecha se formatea con `Intl.DateTimeFormat` en `es-ES` (día, mes largo, año).
- El total se formatea en EUR con `Intl.NumberFormat`.
- El botón "Ver detalles" navega a `/pedidos/{order.id}` usando `<Link>`.
- Hover: borde cambia de `graphite` a `electric-blue` con transición de 200ms.

---

#### OrderStatusBadge

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/private-area/orders/OrderStatusBadge.tsx` |
| Tipo | Component (sin `"use client"`) |

**Descripción**: Badge visual que muestra el estado de un pedido con color codificado. Componente puro sin estado ni efectos.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `status` | `OrderStatus` | Estado del pedido |

**Estilos por estado**:

| Estado | Fondo | Texto |
|--------|-------|-------|
| `pending` | `bg-zinc-500/20` | `text-zinc-400` |
| `processing` | `bg-blue-500/20` | `text-blue-400` |
| `shipped` | `bg-amber-500/20` | `text-amber-400` |
| `delivered` | `bg-green-500/20` | `text-green-400` |
| `cancelled` | `bg-red-500/20` | `text-red-400` |

El texto se obtiene de las traducciones del namespace `Orders` (claves `statusPending`, `statusProcessing`, `statusShipped`, `statusDelivered`, `statusCancelled`). El badge es de tipo `pill` (`rounded-full`) con texto en `uppercase` y `tracking-wide`.

---

#### SettingsContent

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/private-area/SettingsContent.tsx` |
| Tipo | Client Component |

**Descripción**: Componente principal de la página de configuraciones que orquesta tres secciones: preferencias de comunicación, seguridad y zona peligro. Gestiona múltiples estados independientes para cada sección y sus operaciones.

**Estado interno**:

*Communication Preferences*:
- `preferences`: Objeto con las 3 preferencias booleanas (newsletter, orderNotifications, smsPromotions)
- `preferencesLoading`: Estado de carga inicial de preferencias
- `preferencesSaving`: Estado de guardado mientras se actualiza una preferencia
- `preferencesError`: Mensaje de error si falla la carga o actualización
- `preferencesSuccess`: Indicador de éxito temporal (se oculta después de 3 segundos)

*Password Reset*:
- `passwordResetLoading`: Estado de carga durante el envío del email
- `passwordResetSuccess`: Indicador de éxito (se oculta después de 5 segundos)
- `passwordResetError`: Mensaje de error si falla el envío

*Delete Account*:
- `showDeleteModal`: Control de visibilidad del modal de confirmación
- `deleteConfirmEmail`: Email de confirmación ingresado por el usuario
- `deleteLoading`: Estado de carga durante la eliminación
- `deleteError`: Mensaje de error si falla la eliminación

**Flujo de datos**:

1. **Al montar el componente**:
   - Llama `loadPreferences()` que obtiene las preferencias del usuario vía API
   - Muestra spinner mientras carga
   - Si hay error, muestra mensaje de error
   - Si tiene éxito, renderiza las preferencias con los toggles

2. **Al cambiar una preferencia**:
   - Actualiza el estado local inmediatamente (optimistic update)
   - Llama a la API para guardar el cambio
   - Si tiene éxito: Muestra mensaje de éxito temporal
   - Si falla: Revierte el cambio y muestra mensaje de error

3. **Al solicitar cambio de contraseña**:
   - Envía email de restablecimiento al email del usuario actual
   - Muestra spinner en el botón durante el proceso
   - Resultado: Mensaje de éxito o error

4. **Al eliminar cuenta**:
   - Abre modal de confirmación
   - Usuario debe escribir su email exactamente
   - Botón de confirmación deshabilitado hasta que el email coincida
   - Al confirmar: Valida email, elimina cuenta, cierra sesión, redirige a home

**Handlers**:
- `loadPreferences()`: Carga las preferencias del usuario desde la API
- `handlePreferenceChange(key, value)`: Actualiza una preferencia específica
- `handlePasswordReset()`: Envía email de restablecimiento de contraseña
- `handleDeleteAccount()`: Valida email y elimina la cuenta del usuario

**Secciones renderizadas**:

1. **Header**: Título y subtítulo de la página
2. **Communication Preferences**: Card con 3 items, cada uno con toggle Switch
3. **Security**: Card con descripción y botón para enviar email de reset
4. **Danger Zone**: Card con borde rojo, descripción y botón de eliminación

**Endpoints API utilizados**:
- `communicationPreferencesApi.getPreferences()` → GET /communication-preferences
- `communicationPreferencesApi.updatePreferences(data)` → PUT /communication-preferences
- `authApi.forgotPassword({ email })` → POST /auth/forgot-password
- `apiClient.delete("/user")` → DELETE /user

**Componentes utilizados**:
- `Switch`: Para los toggles de preferencias
- `Button`: Para acciones (enviar email, eliminar cuenta)
- `Input`: Para el campo de confirmación de email
- `Label`: Para etiquetas de formulario
- `Modal`: Para el diálogo de confirmación de eliminación
- Lucide icons: `Loader2`, `AlertTriangle`, `CheckCircle2`

**Características especiales**:
- Actualización optimista: Los toggles responden inmediatamente, la sincronización con API es asíncrona
- Auto-hide messages: Los mensajes de éxito desaparecen automáticamente con `setTimeout`
- Validación estricta: El email debe coincidir exactamente para permitir la eliminación
- Protección doble: Botón deshabilitado + validación en el handler para prevenir eliminación accidental

---

#### Modal

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/ui/modal.tsx` |
| Tipo | Client Component |

**Descripción**: Componente modal reutilizable para todos los diálogos de la aplicación. Proporciona un overlay oscuro, contenedor centrado y botón de cierre.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `isOpen` | `boolean` | Control de visibilidad del modal |
| `onClose` | `() => void` | Callback para cerrar el modal |
| `title` | `string` | Título mostrado en el header del modal |
| `children` | `ReactNode` | Contenido del modal (formulario, texto, etc.) |

**Estructura visual**:
- **Overlay**: Fondo negro semi-transparente (`bg-black/80`) que cubre toda la pantalla
- **Container**: Tarjeta centrada con:
  - Fondo `carbon`, borde `graphite`, esquinas redondeadas
  - Ancho máximo: `max-w-md` (448px)
  - Header con título y botón X de cierre
  - Borde inferior en el header (`border-b border-graphite`)
  - Padding: `p-6` para el contenido

**Comportamiento**:
- Si `isOpen` es false, retorna `null` (no renderiza nada)
- Botón de cierre con icono X (Lucide) y aria-label "Close modal"
- Hover en el botón X cambia el color a `electric-blue`

**Uso típico**:
```tsx
<Modal isOpen={showModal} onClose={() => setShowModal(false)} title="My Modal">
  <p>Modal content here...</p>
</Modal>
```

---

#### Switch

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/ui/switch.tsx` |
| Tipo | Client Component (`forwardRef`) |

**Descripción**: Toggle switch accesible para valores booleanos. Implementación personalizada sin dependencias externas, con animaciones suaves y estados visuales claros.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `checked` | `boolean` | Estado actual del switch (on/off) |
| `onCheckedChange` | `(checked: boolean) => void` | Callback que recibe el nuevo estado al hacer clic |
| `disabled` | `boolean` | Deshabilita el switch (opcional) |
| `id` | `string` | ID del elemento HTML (opcional, para asociar con Label) |
| `aria-label` | `string` | Etiqueta accesible para lectores de pantalla (opcional) |

**Comportamiento**:
- Click en el switch invoca `onCheckedChange(!checked)`
- El estado se controla desde el componente padre (controlled component)
- Si está `disabled`, el click no hace nada y se muestra con opacidad reducida
- Transiciones suaves (300ms) en cambios de color y posición del indicador

**Estilos visuales**:

| Estado | Fondo | Indicador |
|--------|-------|-----------|
| Checked | `bg-racing-red` | Posicionado a la derecha (`translate-x-6`) |
| Unchecked | `bg-graphite` | Posicionado a la izquierda (`translate-x-0`) |
| Disabled | Opacidad 50% | — |

**Dimensiones**:
- Container: `h-6 w-12` (24px × 48px)
- Indicador: `h-5 w-5` (20px × 20px) con 2px de margen interno
- Border radius: `rounded-full` (completamente redondeado)

**Accesibilidad**:
- Role: `switch` (ARIA)
- Atributo `aria-checked` refleja el estado actual
- Focus ring visible: `focus:ring-2 focus:ring-racing-red focus:ring-offset-2`
- Type: `button` para prevenir submit de formularios
- Soporte para `aria-label` personalizado

**Uso típico**:
```tsx
<div className="flex items-center gap-3">
  <Switch
    id="newsletter"
    checked={preferences.newsletter}
    onCheckedChange={(checked) => handleChange('newsletter', checked)}
    aria-label="Newsletter subscription"
  />
  <Label htmlFor="newsletter">Newsletter</Label>
</div>
```

**Características especiales**:
- Implementación ligera sin dependencias de Radix UI
- Animación de transición en transform y color (300ms ease-in-out)
- Indicador blanco con sombra (`shadow-lg`) para mejor contraste
- Focus ring offset para separación visual del borde del switch
- Compatible con React Hook Form vía `forwardRef`

---

#### HeroSection

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/home/HeroSection.tsx` |
| Tipo | Client Component |

**Descripción**: Sección hero de la página principal con un diseño full-screen. Presenta el título principal del sitio, tagline y botones CTA sobre un fondo oscuro con gradientes y patrones radiales.

**Características visuales**:
- Fondo: Gradiente de `obsidian` a `carbon` con overlays radiales en colores de marca (rojo y azul con opacidad baja).
- Gradiente inferior desde `obsidian/90` para transición suave con las siguientes secciones.
- Indicador de scroll animado (`ChevronDown`) con animación `bounce-slow`.

**Estructura del contenido**:
1. **Título principal**: `<h1>` con texto localizado desde `home.hero.title`, tipografía bold de 4xl a 5xl/56px según breakpoint.
2. **Tagline**: Texto secundario en `text-silver` localizado desde `home.tagline`.
3. **CTAs**: Dos botones en layout flex-wrap con gap.
   - **Primario ("EXPLORAR PRODUCTOS")**: Botón rojo (`bg-racing-red`) con hover shadow y efecto glow. Usa `<Button asChild>` con `<Link>` de next-intl para navegación locale-aware a `/productos`.
   - **Secundario**: Botón outline con borde blanco y hover sobre fondo semi-transparente. Localizado desde `home.hero.ctaSecondary`.

**Navegación**:
- El botón principal enlaza a `/productos` usando el componente `Link` de `@/i18n/navigation`, lo que garantiza URLs con prefijo de locale (ej: `/es/productos`, `/en/productos`).
- Patrón usado: `<Button asChild>` con `<Link href="/productos">` como children.

---

#### FeaturedCategories

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/home/FeaturedCategories.tsx` |
| Tipo | Client Component |

**Descripción**: Sección que muestra las 5 categorías principales de productos cargadas desde la API del backend. Usa un grid asimétrico donde las dos primeras categorías ocupan más espacio (diseño masonry).

**Integración con API**:
- **Endpoint**: `GET /api/categories` vía `categoriesApi.getCategories()`.
- **Parámetros**: `{ locale, page: 1, pageSize: 5, isActive: true }`.
- **Tipo de respuesta**: `PaginatedResult<CategoryListItem>`.
- **Effect**: Se recarga cuando cambia el `locale`.

**Estados del componente**:

1. **Loading**: Muestra skeleton UI con 5 placeholders animados (`animate-pulse`) respetando el layout del grid (2 grandes + 3 pequeños).
2. **Sin datos**: Si `categories.length === 0`, retorna `null` (no renderiza nada).
3. **Éxito**: Renderiza el grid completo con las categorías.

**Layout del grid**:
- Mobile (`<md`): 1 columna, todas las categorías del mismo tamaño.
- Desktop (`≥md`): Grid de 4 columnas con `auto-rows-[280px]`, las primeras 2 categorías (`index < 2`) ocupan `col-span-2 row-span-2` (formato destacado).

**Renderizado de cada categoría**:
- Envuelta en `<a>` con href `/{locale}/categories/{slug}` (construido manualmente con locale).
- **Fondo**: Si existe `imageUrl`, muestra la imagen con `object-cover` y hover `scale-105`. Si no, usa un gradiente de respaldo (5 variantes cíclicas).
- **Overlay**: Gradiente oscuro desde la parte inferior con contenido:
  - Nombre de la categoría en `<h3>` (tamaño `text-2xl` si es grande, `text-lg` si es pequeña).
  - Descripción corta (`line-clamp-2`) si existe `shortDescription`.
  - Link de acción "Explore →" en `text-electric-blue`.

**Gradientes de respaldo**: Array `GRADIENTS` con 5 variantes (`from-racing-red/20`, `from-electric-blue/20`, etc.).

---

#### FeaturedProducts

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/home/FeaturedProducts.tsx` |
| Tipo | Client Component |

**Descripción**: Sección que muestra 4 productos destacados personalizables cargados desde la API del backend. Reutiliza el componente `ProductCard` para mantener consistencia visual con el catálogo.

**Integración con API**:
- **Endpoint**: `GET /api/products` vía `productsApi.getProducts()`.
- **Parámetros**: `{ locale, page: 1, pageSize: 4, isCustomizable: true }`.
- **Tipo de respuesta**: `PaginatedResult<ProductListItem>`.
- **Effect**: Se recarga cuando cambia el `locale`.

**Estados del componente**:

1. **Loading**: Muestra skeleton UI con 4 placeholders animados (`animate-pulse`) que simulan la estructura de `ProductCard` (imagen + contenido con barras de placeholder).
2. **Sin datos**: Si `products.length === 0`, retorna `null` (no renderiza nada).
3. **Éxito**: Renderiza el grid con los productos usando `ProductCard`.

**Layout del grid**:
- Grid responsivo: `grid-cols-1 sm:grid-cols-2 lg:grid-cols-4`.
- Ancho máximo: `max-w-[1400px]` centrado con `mx-auto`.
- Gap: `gap-8` entre cards.

**Composición**:
```tsx
{products.map((product) => (
  <ProductCard key={product.id} product={product} />
))}
```

Cada producto se renderiza con el componente `ProductCard`, que incluye imagen, badge de personalizable, botón de wishlist, SKU, nombre, descripción corta y precio.

---

#### NewsletterSection

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/home/NewsletterSection.tsx` |
| Tipo | Client Component |

**Descripción**: Sección de suscripción al newsletter ubicada al final de la página de inicio. Diseñada con un fondo rojo vibrante (racing-red) y un formulario compacto para captura de emails.

**Características visuales**:
- Fondo: Gradiente de `racing-red` a `racing-red/80` con overlays radiales decorativos con opacidad baja.
- Formulario centrado con ancho máximo de `max-w-md` (448px).
- Input de email con fondo blanco forzado (`!bg-white`) y focus ring oscuro.
- Botón de suscripción con fondo blanco y texto rojo.

**Estructura del contenido**:
1. **Título principal**: `<h2>` con texto localizado desde `home.newsletter.title`, tipografía semibold de 4xl.
2. **Subtítulo**: Texto secundario en `text-white/90` localizado desde `home.newsletter.subtitle`.
3. **Formulario**: Layout flex responsivo (columna en mobile, fila en desktop):
   - **Input email**: Campo requerido con placeholder traducido, padding vertical personalizado.
   - **Botón submit**: Muestra "SUBSCRIBE" o "SUBSCRIBING..." según el estado de carga.
4. **Mensaje de privacidad**: Texto pequeño en `text-white/80` indicando respeto a la privacidad.

**Estados del componente**:
- `email: string` — Valor del input de email.
- `isSubmitting: boolean` — Controla el estado de carga durante el envío.

**Comportamiento**:
- El formulario actualmente es un mock que simula 1 segundo de carga.
- Al enviar, limpia el campo de email y resetea el estado.
- TODO: Integrar con API de newsletter cuando esté disponible.

**Traducciones**: Todas las cadenas de texto están localizadas en `home.newsletter.*` (title, subtitle, emailPlaceholder, subscribe, subscribing, privacy).

---

#### Navbar

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/layout/Navbar.tsx` |
| Tipo | Client Component |

**Descripción**: Barra de navegación principal sticky con altura fija de 72px (`h-18`), fondo semi-transparente con backdrop blur y borde inferior. Incluye logo, links de navegación, acciones de usuario y menú mobile.

**Estructura**:

```
┌─────────────────────────────────────────────────────────┐
│ [LOGO]  [Nav Links Desktop]   [Search][User][Cart][☰]  │
└─────────────────────────────────────────────────────────┘
  ↓ Mobile Menu (condicional)
┌─────────────────────────────────────────────────────────┐
│ Link 1                                                   │
│ ──────────────────────────────────────────────────────  │
│ Link 2                                                   │
│ ──────────────────────────────────────────────────────  │
│ ...                                                      │
└─────────────────────────────────────────────────────────┘
```

**Secciones**:

1. **Logo**: Link a home (`/`) con texto "SIM**RACING**" donde "RACING" está en `text-racing-red`.

2. **Links de navegación** (desktop, ocultos en mobile `md:flex`):
   - Array `NAV_LINKS` define 5 links: products, wheels, pedals, cockpits, accessories.
   - El link "products" tiene `localized: true` y usa `<Link>` de next-intl con href `/productos`.
   - Los demás usan `<a href="#">` (placeholders).
   - Todos los textos están traducidos desde `nav.{key}` y transformados a mayúsculas.

3. **Acciones** (siempre visible):
   - **Search**: `<Link>` (antes botón) que navega a `/productos` con icono de búsqueda. Usa `Link` de next-intl para soporte locale-aware.
   - **User**: `<Link>` a `/login` con icono de usuario.
   - **Cart**: `<button>` con icono de carrito y badge numérico con el total de unidades del store (`useCartItemCount`). Oculto si el carrito está vacío. Al hacer clic, alterna la visibilidad del `MiniCart`. Posicionado con `relative` para anclar el panel desplegable. El componente `MiniCart` se renderiza debajo del botón.
   - **Mobile Menu Toggle**: Botón `md:hidden` que alterna `mobileMenuOpen` y cambia entre iconos `X` / `Menu`.

4. **Mobile Menu** (condicional, `{mobileMenuOpen && ...}`):
   - Renderiza los mismos `NAV_LINKS` en layout vertical.
   - Cada link tiene borde inferior (`border-b border-graphite`).
   - Click en un link cierra el menú (`onClick={() => setMobileMenuOpen(false)`).

**Navegación locale-aware**:
- Tanto el botón de búsqueda como el link de productos usan el componente `Link` de `@/i18n/navigation`, lo que garantiza URLs con prefijo de locale correcto (ej: `/es/productos`, `/en/productos`).
- Aria labels localizados desde `nav.search`, `nav.account`, `nav.cart`, `nav.menu`.

**Estilos**:
- Sticky positioning (`sticky top-0 z-50`).
- Fondo: `bg-obsidian/95` con `backdrop-blur-md`.
- Hover en links y acciones: `hover:text-electric-blue`.
- Ancho máximo del contenedor: `max-w-[1400px]`.

---

#### Footer

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/layout/Footer.tsx` |
| Tipo | Client Component |

**Descripción**: Footer global de la aplicación presente en todas las páginas. Diseñado con un layout de 4 columnas que incluye información de marca, navegación organizada por categorías, enlaces sociales y legales.

**Estructura**:

```
┌─────────────────────────────────────────────────────────────┐
│  [BRAND + TAGLINE]    [SHOP]         [SUPPORT]    [COMPANY] │
│  [Social Icons]       • Products     • Contact    • About   │
│                       • Categories   • FAQ        • Blog    │
│                       • New Arrivals • Shipping   • Careers │
│                       • Sale         • Returns    • Press   │
├─────────────────────────────────────────────────────────────┤
│  © 2026 SimRacing... [Privacy Policy] [Terms of Service]    │
└─────────────────────────────────────────────────────────────┘
```

**Secciones principales**:

1. **Brand Column**:
   - Logo "SIM**RACING**" con link a home (`/`) donde "RACING" está en `text-racing-red`.
   - Tagline traducido desde `footer.tagline` en `text-silver`.
   - Iconos sociales (Facebook, Twitter/X, LinkedIn, YouTube) en layout horizontal con hover `text-electric-blue`.

2. **Shop Column**:
   - Título "Shop" desde `footer.shop.title`.
   - Links: Products (usa `Link` de next-intl para locale-aware), Categories, New Arrivals, Sale.
   - Products es el único link funcional, los demás son placeholders (`href="#"`).

3. **Support Column**:
   - Título "Support" desde `footer.support.title`.
   - Links: Contact, FAQ, Shipping, Returns (todos placeholders).

4. **Company Column**:
   - Título "Company" desde `footer.company.title`.
   - Links: About, Blog, Careers, Press (todos placeholders).

**Footer Bottom**:
- Separado del contenido principal con `border-t border-graphite`.
- Layout flex responsivo (columna en mobile, fila en desktop).
- Copyright dinámico: Muestra el año actual obtenido de `new Date().getFullYear()`.
- Enlaces legales: Privacy Policy y Terms of Service con hover `text-electric-blue`.

**Layout responsivo**:
- Desktop (`≥lg`): Grid de 4 columnas con `gap-12`.
- Tablet (`≥md`): Grid de 2 columnas.
- Mobile (`<md`): 1 columna con todos los elementos apilados.

**Navegación locale-aware**:
- El link "Products" usa el componente `Link` de `@/i18n/navigation`, garantizando URLs con prefijo de locale correcto (ej: `/es/productos`, `/en/productos`).

**Estilos**:
- Fondo: `bg-obsidian` con `border-t border-graphite`.
- Padding: `py-16 px-8` (vertical 64px, horizontal 32px).
- Hover en links: `hover:text-electric-blue`.
- Ancho máximo del contenedor: `max-w-[1400px]`.
- Títulos de columnas: `text-base font-semibold text-white`.
- Links: `text-silver` con transición de color.

**Traducciones**: Todas las cadenas de texto están localizadas en `footer.*` con estructura jerárquica (tagline, shop.*, support.*, company.*, copyright, privacy, terms).

---

#### ProductCard

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/ProductCard.tsx` |
| Tipo | Client Component |

**Descripción**: Tarjeta de producto reutilizable para el grid del catálogo. Muestra imagen, SKU, nombre, descripción corta y precio. Envuelta en un `<Link>` que navega a la página de detalle (`/productos/{slug}`).

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `product` | `ProductListItem` | Datos del producto desde la API |

**Características**:
- Badge "Personalizable" (`bg-electric-blue`) si `isCustomizable` es `true`.
- Botón de wishlist (corazón) con `e.preventDefault()` para evitar navegación al hacer clic.
- Hover: Elevación (`-translate-y-1`), borde visible y zoom sutil en la imagen.
- Fallback SVG cuando no hay imagen disponible.

---

#### ProductGrid

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/ProductGrid.tsx` |
| Tipo | Client Component |

**Descripción**: Grid responsivo que renderiza `ProductCard` o skeletons de carga. Layout de 1 a 3 columnas según el breakpoint.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `products` | `ProductListItem[]` | Array de productos |
| `loading` | `boolean` | Muestra skeletons si `true` |

---

#### ProductFilters

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/ProductFilters.tsx` |
| Tipo | Client Component |

**Descripción**: Panel lateral de filtros para el catálogo. Incluye campo de búsqueda, rango de precio, toggle de personalizables y selector de ordenamiento.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `filters` | `FilterValues` | Estado actual de los filtros |
| `onFiltersChange` | `(filters: FilterValues) => void` | Callback cuando los filtros cambian |

---

#### Pagination

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/Pagination.tsx` |
| Tipo | Client Component |

**Descripción**: Controles de paginación con botones anterior/siguiente e indicador de página actual.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `currentPage` | `number` | Página actual |
| `totalPages` | `number` | Total de páginas |
| `onPageChange` | `(page: number) => void` | Callback al cambiar de página |

---

#### ProductImageGallery

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/ProductImageGallery.tsx` |
| Tipo | Client Component |

**Descripción**: Galería de imágenes del producto con imagen principal y tira de thumbnails. Las imágenes se ordenan por `displayOrder`. El thumbnail seleccionado se resalta con borde `racing-red`.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `images` | `ProductImage[]` | Array de imágenes del producto |
| `productName` | `string` | Nombre del producto (para alt text) |

**Estados internos**: `selectedIndex` — Índice de la imagen seleccionada.

**Comportamiento**:
- Click en thumbnail cambia la imagen principal.
- Tira de thumbnails con scroll horizontal (`overflow-x-auto`).
- Fallback SVG cuando el array de imágenes está vacío.

---

#### ProductInfo

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/ProductInfo.tsx` |
| Tipo | Client Component |

**Descripción**: Sección de información del producto. Muestra breadcrumb, nombre, precio con IVA, estado de stock, descripción corta, botón de personalización y trust indicators.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `product` | `ProductDetail` | Datos completos del producto |

**Secciones renderizadas**:
1. **Breadcrumb**: Inicio / Productos / {nombre} (usando `<Link>` de `@/i18n/navigation`).
2. **Nombre**: `<h1>` con `text-3xl md:text-4xl font-bold`.
3. **SKU + Badge**: SKU en texto secundario, badge "Personalizable" si aplica.
4. **Rating**: Placeholder con 5 cuadros grises (sin sistema de reviews implementado).
5. **Precio**: Precio con IVA en grande + precio sin IVA y tasa en texto secundario. Cálculo: `basePrice * (1 + vatRate / 100)`.
6. **Stock**: Indicador verde "En stock" si `isActive`, rojo "Agotado" si no.
7. **Descripción corta**: Si existe `shortDescription`.
8. **Botón "PERSONALIZAR"**: Visible solo si `isCustomizable`, estilo CTA primario (`bg-racing-red`).
9. **Tiempo de producción**: Icono reloj + `{baseProductionDays} días`.
10. **Peso**: Si existe `weightGrams`, icono paquete + `{grams}g`.
11. **Trust indicators**: Envío gratis, garantía 2 años, pago seguro (iconos Lucide en `electric-blue`).

---

#### ProductSpecifications

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/ProductSpecifications.tsx` |
| Tipo | Client Component |

**Descripción**: Tabla de especificaciones técnicas con filas alternadas (zebra stripes). Las especificaciones se ordenan por `displayOrder`.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `specifications` | `ProductSpecification[]` | Array de especificaciones |

**Estilo**: Filas pares con `bg-graphite/50`, impares con `bg-carbon`. Clave en `text-silver`, valor en `text-white`.

---

#### ProductJsonLd

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/products/ProductJsonLd.tsx` |
| Tipo | Component (sin `"use client"`) |

**Descripción**: Componente que inyecta un `<script type="application/ld+json">` con datos estructurados schema.org/Product para SEO.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `product` | `ProductDetail` | Datos del producto |
| `locale` | `string` | Locale actual |

**Schema generado**:
- `@type`: `Product`
- `name`, `description`, `sku`: Datos del producto.
- `image`: Array de URLs de imágenes ordenadas por `displayOrder`.
- `offers`: Tipo `Offer` con precio (IVA incluido, EUR), disponibilidad (`InStock`/`OutOfStock`), URL canónica.
- `weight`: (opcional) `QuantitativeValue` en gramos si `weightGrams` existe.

---

#### MiniCart

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/cart/MiniCart.tsx` |
| Tipo | Client Component |

**Descripción**: Panel desplegable del carrito anclado bajo el botón de carrito de la `Navbar`. Proporciona una vista rápida del contenido del carrito sin abandonar la página actual. Se compone de dos sub-elementos: `MiniCart` (panel contenedor) y `MiniCartItemRow` (fila de item individual, definida en el mismo archivo).

**Props** (`MiniCart`):

| Prop | Tipo | Descripción |
|------|------|-------------|
| `isOpen` | `boolean` | Controla si el panel es visible |
| `onClose` | `() => void` | Callback para cerrar el panel |

**Comportamiento de cierre**:
- **Click fuera**: Listener `mousedown` en `document` que comprueba si el clic fue fuera del `panelRef`. Se registra solo cuando `isOpen` es `true`.
- **Tecla Escape**: Listener `keydown` en `document` que llama `onClose()` al pulsar `Escape`. Se registra solo cuando `isOpen` es `true`.
- Ambos listeners se limpian en el `return` del `useEffect` correspondiente.

**Estructura visual**:
```
┌──────────────────────────────────────────┐
│ Header: "Mi carrito"    N artículos/item │
├──────────────────────────────────────────┤
│ [Estado vacío]                           │  ← si no hay items
│  Icono ShoppingCart                      │
│  Mensaje vacío                           │
│  [Explorar Productos]                    │
├──────────────────────────────────────────┤  ← si hay items
│ Lista de MiniCartItemRow (scroll)        │
│  ┌─────────────────────────────────────┐ │
│  │ [img 80×80] Nombre     [X eliminar] │ │
│  │             Cantidad: N             │ │
│  │             €XX.XX                  │ │
│  └─────────────────────────────────────┘ │
├──────────────────────────────────────────┤
│ Footer: Subtotal: €XX.XX                 │
│  [VER CARRITO]    ← bg-racing-red        │
│  [FINALIZAR COMPRA] ← border-graphite    │
└──────────────────────────────────────────┘
```

**Dimensiones y posicionamiento**:
- Ancho fijo: `w-[380px]`.
- Posición: `absolute right-0 top-full` respecto al botón de carrito (`relative`) en la Navbar.
- Z-index: `z-50`.
- Lista de items: `max-h-[400px]` con `overflow-y-auto` y scrollbar personalizada (`scrollbar-width: thin`).

**Estados**:
- **Vacío**: Muestra estado vacío con icono y CTA. Al hacer clic en "Explorar Productos" llama `onClose()` antes de navegar.
- **Con items**: Muestra la lista scrollable + footer con subtotal y botones de acción.
- **Loading**: El botón "VER CARRITO" se deshabilita visualmente (`pointer-events-none opacity-60`) durante `isLoading`.

**Acciones**:
- **Eliminar item**: Cada `MiniCartItemRow` tiene un botón X que llama `removeItem(item.productId)` del store.
- **Ver carrito**: Enlace a `/{locale}/carrito` que cierra el panel al navegar.
- **Finalizar compra**: Enlace a `/{locale}/checkout` que cierra el panel al navegar.

**Internacionalización**: Usa el namespace `Cart` de `next-intl` (`miniTitle`, `articleSingular`, `articlePlural`, `emptyMessage`, `exploreProducts`, `quantity`, `remove`, `subtotalLabel`, `viewCart`, `checkout`).

---

#### CartContent

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/app/[locale]/carrito/CartContent.tsx` |
| Tipo | Client Component |

**Descripción**: Componente principal de la página de carrito. Orquesta la carga del carrito, los estados de UI y delega el renderizado de cada item a `CartItemRow` y el resumen lateral a `CartSummary`.

**Estado** (desde `useCartStore`):
- `cart`: `CartDto | null` — Datos actuales del carrito.
- `isLoading`: `boolean` — Indica si hay una operación API en curso.
- `fetchCart`: Función para cargar el carrito desde la API.
- `updateItem`: Función para actualizar la cantidad de un item (optimista).
- `removeItem`: Función para eliminar un item (optimista).
- `clearCart`: Función para vaciar el carrito (optimista).
- `_hasHydrated`: `boolean` — Flag de hidratación del store desde `localStorage`.

**Flujo de datos**:
1. `useEffect` observa `_hasHydrated`. Cuando es `true`, llama `fetchCart(locale)`.
2. Durante la primera carga (`isLoading && items.length === 0`), renderiza el skeleton.
3. Si el carrito está vacío tras cargar, renderiza el estado vacío.
4. Si hay items, renderiza el layout de dos columnas.

**Internacionalización**: Usa el namespace `Cart` (`breadcrumbHome`, `breadcrumbCart`, `title`, `itemsTitle`, `clearCart`, `empty`, `emptyMessage`, `exploreProducts`).

---

#### CartItemRow

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/cart/CartItemRow.tsx` |
| Tipo | Client Component |

**Descripción**: Fila de item de carrito en la página completa. Muestra imagen, información del producto, selector de cantidad, botón de eliminar y precio. Diseño en grid de 3 columnas: `[120px | 1fr | auto]`.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `item` | `CartItemDto` | Datos del item del carrito |
| `onUpdate` | `(quantity: number) => void` | Callback al cambiar la cantidad |
| `onRemove` | `() => void` | Callback al eliminar el item |
| `isLoading` | `boolean` | Deshabilita acciones durante operaciones API |

**Columnas**:

1. **Imagen**: `120×90px` con `object-cover`. Si no hay `imageUrl`, muestra un icono `ShoppingCart` como fallback.
2. **Información**:
   - SKU en `text-silver text-sm`.
   - Nombre del producto en `text-lg font-semibold`.
   - Badge de stock: `● En stock` en `text-success`.
   - `QuantitySelector` con rango `[1, 99]` y los handlers `onIncrease`/`onDecrease`.
   - Botón "Eliminar" en `text-error` que llama `onRemove()`.
3. **Precio**: Precio subtotal en `text-2xl font-bold`. Si `quantity > 1`, muestra el precio unitario (`€X.XX / ud.`) en `text-xs text-silver`.

---

#### QuantitySelector

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/cart/QuantitySelector.tsx` |
| Tipo | Client Component |

**Descripción**: Control de cantidad con botones de incremento y decremento. Componente presentacional puro sin estado propio.

**Props**:

| Prop | Tipo | Default | Descripción |
|------|------|---------|-------------|
| `value` | `number` | — | Cantidad actual |
| `onIncrease` | `() => void` | — | Callback al incrementar |
| `onDecrease` | `() => void` | — | Callback al decrementar |
| `min` | `number` | `1` | Valor mínimo permitido |
| `max` | `number` | `99` | Valor máximo permitido |
| `disabled` | `boolean` | — | Deshabilita ambos botones |

**Comportamiento**:
- El botón `−` se deshabilita si `value <= min` o si `disabled` es `true`.
- El botón `+` se deshabilita si `value >= max` o si `disabled` es `true`.
- El valor se muestra en `min-w-[2rem]` con `tabular-nums` para evitar saltos de layout.

**Estilos**:
- Fondo `bg-graphite` con botones de `size-8`.
- Hover: `hover:text-electric-blue`. Cursor `not-allowed` cuando está deshabilitado.

**Accesibilidad**: `aria-label` en cada botón usando las claves `Cart.decrease` y `Cart.increase`.

---

#### CartSummary

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/cart/CartSummary.tsx` |
| Tipo | Client Component |

**Descripción**: Panel lateral de resumen del pedido. Muestra el desglose de precios (subtotal, envío, IVA, total), indicador de envío gratis, badge de pago seguro, botones de acción y métodos de pago aceptados. En desktop es `sticky` a `top-24`.

**Props**:

| Prop | Tipo | Descripción |
|------|------|-------------|
| `cart` | `CartDto` | Datos del carrito |
| `isLoading` | `boolean` | Deshabilita el botón de checkout durante operaciones |

**Lógica de envío**:
- Umbral de envío gratis: `FREE_SHIPPING_THRESHOLD = 100` (€).
- Si `cart.subtotal >= 100`: Envío gratis (`text-success`).
- Si `cart.subtotal < 100`: Envío `€4.99`.
- El total mostrado incluye el coste de envío cuando aplica.

**Secciones**:

1. **Desglose de precios**:
   - Subtotal (con número de items).
   - Envío: "Gratis" en verde o "€4.99".
   - IVA: `cart.vatAmount`.
   - Total: `cart.total + envío` en `text-xl font-bold`.

2. **Indicador de envío gratis** (condicional): Banner azul con icono `Truck` si `hasFreeShipping`. Borde izquierdo `electric-blue`.

3. **Badge de pago seguro**: Icono `Lock` + texto traducido. Fondo `obsidian`.

4. **Botones CTA**:
   - **"FINALIZAR COMPRA"**: `Button variant="default" size="xxl"` con `<Link href="/checkout">`. Deshabilitado durante `isLoading`.
   - **"SEGUIR COMPRANDO"**: `Button variant="secondary" size="xl"` con `<Link href="/productos">`.

5. **Métodos de pago**: Badges de texto para Visa, Mastercard, PayPal y Klarna.

**Internacionalización**: Namespace `Cart` (`orderSummary`, `subtotalLine`, `shipping`, `shippingFree`, `vatLine`, `total`, `freeShippingTitle`, `freeShippingMessage`, `securePayment`, `proceedToCheckout`, `continueShopping`, `paymentMethods`).

---

#### CartToast

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/components/cart/CartToast.tsx` |
| Tipo | Client Component |

**Descripción**: Notificación toast global que aparece en la esquina inferior derecha cuando se añade un producto al carrito. Se auto-cierra tras 3,5 segundos.

**Sin props**: Lee el estado directamente de `useCartStore` (`lastAddedItem`, `clearNotification`).

**Comportamiento**:
- Si `lastAddedItem` es `null`, retorna `null` (no renderiza nada).
- Al aparecer `lastAddedItem`, inicia un `setTimeout` de `TOAST_DURATION_MS = 3500ms` que llama `clearNotification()`.
- El timer se cancela con `clearTimeout` en el cleanup del `useEffect` para evitar memory leaks si el toast se cierra manualmente antes de expirar.

**Estructura visual**:
```
╔══════════════════════════════════════╗
║ ✓  [Nombre producto] añadido al..  ✕ ║
╚══════════════════════════════════════╝
  └── fixed bottom-6 right-6 z-[100]
```
- Icono `CheckCircle` en `text-success`.
- Nombre del producto en `font-semibold`.
- Botón X para cierre manual que llama `clearNotification()`.
- Animación de entrada: `animate-in slide-in-from-bottom-4 duration-300`.

**Accesibilidad**: `role="status"` y `aria-live="polite"` para que los lectores de pantalla anuncien el mensaje.

**Integración**: Renderizado en el layout global (`[locale]/layout.tsx`) para estar disponible en todas las páginas. El store actualiza `lastAddedItem` cuando `addItem` recibe respuesta exitosa de la API.

---

#### CartStore (`cart-store.ts`)

| Propiedad | Valor |
|-----------|-------|
| Ruta | `src/stores/cart-store.ts` |
| Tipo | Zustand store con `persist` middleware |

**Descripción**: Store global del carrito que gestiona el estado, las operaciones API y la persistencia local del carrito. Soporta tanto usuarios anónimos (sesión UUID en `localStorage`) como autenticados (carrito asociado a la cuenta).

**Estado** (`CartState`):

| Campo | Tipo | Descripción |
|-------|------|-------------|
| `cart` | `CartDto \| null` | Datos actuales del carrito |
| `isLoading` | `boolean` | Operación API en curso |
| `error` | `string \| null` | Mensaje de error de la última operación |
| `lastAddedItem` | `string \| null` | Nombre del último producto añadido (para `CartToast`) |
| `_hasHydrated` | `boolean` | Flag que indica que el store fue rehidratado desde `localStorage` |

**Acciones** (`CartActions`):

| Acción | Descripción |
|--------|-------------|
| `initSession()` | Genera o recupera el UUID de sesión anónima en `localStorage` |
| `fetchCart(locale?)` | Carga el carrito desde la API |
| `addItem(productId, quantity?, locale?)` | Añade un producto, actualiza `lastAddedItem` con el nombre |
| `updateItem(productId, quantity, locale?)` | Actualiza la cantidad con **actualización optimista** |
| `removeItem(productId)` | Elimina un item con **actualización optimista** |
| `clearCart()` | Vacía el carrito con **actualización optimista** |
| `mergeCart(sessionId, locale?)` | Fusiona el carrito anónimo con el del usuario tras login |
| `clearNotification()` | Limpia `lastAddedItem` (llamado por `CartToast`) |
| `reset()` | Restaura el estado inicial (mantiene `_hasHydrated: true`) |

**Actualización optimista**: `updateItem`, `removeItem` y `clearCart` aplican el cambio localmente de inmediato (recalculando totales con `recalcCart()`) y luego sincronizan con la API. Si la API falla, restauran el estado previo.

**Función `recalcCart(items)`**: Recalcula `totalItems`, `subtotal`, `vatAmount` y `total` en el cliente a partir del array de items, permitiendo feedback instantáneo sin esperar respuesta del servidor.

**Persistencia** (`persist` middleware):
- `name`: `"cart-storage"` — Clave en `localStorage`.
- `partialize`: Solo persiste `cart` (no `isLoading`, `error`, `lastAddedItem`, ni `_hasHydrated`).
- `onRehydrateStorage`: Al rehidratar desde `localStorage`, establece `_hasHydrated = true` para señalizar que el store está listo.

**Selector hooks exportados**:
- `useCart()` — Retorna `cart`.
- `useCartItemCount()` — Retorna `cart?.totalItems ?? 0`. Usado en la Navbar para el badge.
- `useCartLoading()` — Retorna `isLoading`.

**Gestión de sesión anónima** (en `src/lib/api/cart.ts`):
- `SESSION_ID_KEY = "cart-session-id"` — Clave en `localStorage`.
- `ensureSessionId()`: Devuelve el UUID existente o genera uno nuevo con `crypto.randomUUID()`.
- `sessionHeaders()`: Añade `X-Cart-Session: {uuid}` a las peticiones API. El backend ignora esta cabecera si el usuario está autenticado.
- `clearSessionId()`: Elimina el UUID tras un merge exitoso.

**Endpoints API** (todos con cabecera `X-Cart-Session` cuando hay sesión anónima):

| Método | URL | Descripción |
|--------|-----|-------------|
| `GET` | `/cart?locale={locale}` | Obtiene el carrito actual |
| `POST` | `/cart/items?locale={locale}` | Añade un item (`AddToCartDto`) |
| `PUT` | `/cart/items/{productId}?locale={locale}` | Actualiza cantidad (`UpdateCartItemDto`) |
| `DELETE` | `/cart/items/{productId}` | Elimina un item |
| `DELETE` | `/cart` | Vacía el carrito |
| `POST` | `/cart/merge?locale={locale}` | Fusiona carrito anónimo con autenticado (`MergeCartDto`) |

---

### Componentes UI (Primitivas)

Basados en el patrón **shadcn/ui** con primitivas **Radix UI** y estilizado con **Tailwind CSS** y **class-variance-authority**.

| Componente | Archivo | Base | Descripción |
|------------|---------|------|-------------|
| `Button` | `ui/button.tsx` | CVA | Botón con variantes (`default`, `destructive`, `outline`, `secondary`, `ghost`, `link`) y tamaños (`xs`, `sm`, `default`, `lg`, `icon`). Soporta `asChild` vía Radix `Slot`. |
| `Card` | `ui/card.tsx` | div | Conjunto de componentes (`Card`, `CardHeader`, `CardTitle`, `CardDescription`, `CardAction`, `CardContent`, `CardFooter`) con atributos `data-slot` para targeting CSS. |
| `Checkbox` | `ui/checkbox.tsx` | Radix Checkbox | Checkbox accesible con indicador `CheckIcon` de Lucide. |
| `Input` | `ui/input.tsx` | input | Campo de texto con estilos consistentes, focus ring, y soporte `aria-invalid`. |
| `Label` | `ui/label.tsx` | Radix Label | Etiqueta accesible con estilos tipográficos consistentes. |
| `Modal` | `ui/modal.tsx` | div | Modal reutilizable con overlay oscuro, contenedor centrado, header con título y botón de cierre. Usado en modales de edición de perfil y direcciones. |
| `Switch` | `ui/switch.tsx` | button | Toggle switch accesible con role="switch", animaciones suaves y estados visuales (rojo/gris). Implementación custom sin dependencias de Radix. Usado en página de configuraciones. |

---

### Sistema de Diseño

#### Paleta de Colores

El tema visual está orientado al mundo del motorsport con una paleta oscura y acentos vibrantes:

```
Fondos                    Acentos                   Estados
┌──────────────────┐     ┌──────────────────┐      ┌──────────────────┐
│ obsidian  #0A0A0A│     │ racing-red #E53935│      │ success  #22C55E │
│ (fondo principal)│     │ (CTA principal)   │      │ (éxito)          │
├──────────────────┤     ├──────────────────┤      ├──────────────────┤
│ carbon    #171717│     │ electric   #2196F3│      │ warning  #F59E0B │
│ (tarjetas)       │     │ -blue (enlaces)   │      │ (advertencia)    │
├──────────────────┤     ├──────────────────┤      ├──────────────────┤
│ graphite  #262626│     │ champagne  #C9AF89│      │ error    #EF4444 │
│ (bordes)         │     │ (premium)         │      │ (error)          │
└──────────────────┘     └──────────────────┘      └──────────────────┘

Textos
┌──────────────────┐
│ white     #FFFFFF│  → Texto principal
│ silver    #9CA3AF│  → Texto secundario, placeholders
│ smoke     #4B5563│  → Texto terciario, ayuda
└──────────────────┘
```

#### Tipografía

- **Fuente principal**: Geist Sans (variable: `--font-geist-sans`)
- **Fuente monoespaciada**: Geist Mono (variable: `--font-geist-mono`)
- **Carga**: Google Fonts con subset `latin`

#### Tokens CSS

Los tokens están definidos en `globals.css` usando variables CSS nativas y el sistema OKLCH de shadcn/ui:

- **Border radius**: Sistema escalable desde `--radius: 0.625rem` con variantes `sm` a `4xl`.
- **Variante dark**: Activada por la clase `.dark` en `<html>` (siempre activa por defecto).
- **Animaciones**: Proporcionadas por `tw-animate-css`.
