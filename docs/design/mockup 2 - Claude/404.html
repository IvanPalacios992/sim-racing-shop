<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>404 â€” PÃ¡gina no encontrada | SimRacing Shop</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --obsidian-black: #0A0A0A;
            --carbon-gray: #171717;
            --graphite: #262626;
            --racing-red: #E53935;
            --electric-blue: #2196F3;
            --champagne-gold: #C9AF89;
            --pure-white: #FFFFFF;
            --silver: #9CA3AF;
            --smoke: #4B5563;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.5);
            --shadow-glow: 0 0 20px rgba(229, 57, 53, 0.4);
            --shadow-glow-blue: 0 0 20px rgba(33, 150, 243, 0.3);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--obsidian-black);
            color: var(--pure-white);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* â”€â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .site-header {
            position: sticky;
            top: 0;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(12px);
            height: 72px;
            border-bottom: 1px solid var(--graphite);
            z-index: 100;
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            height: 100%;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--pure-white);
            text-decoration: none;
        }

        .logo span { color: var(--racing-red); }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--pure-white);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover { color: var(--electric-blue); }

        .header-actions {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .icon-btn {
            background: transparent;
            border: none;
            color: var(--pure-white);
            cursor: pointer;
            transition: color 0.3s;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn:hover { color: var(--electric-blue); }

        .material-symbols-outlined {
            font-family: 'Material Symbols Outlined';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            direction: ltr;
            -webkit-font-smoothing: antialiased;
            font-feature-settings: 'liga';
        }

        /* â”€â”€â”€ 404 Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .error-page {
            min-height: calc(100vh - 72px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem 2rem;
            position: relative;
            overflow: hidden;
        }

        /* Animated background grid */
        .error-page::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image:
                linear-gradient(rgba(229, 57, 53, 0.04) 1px, transparent 1px),
                linear-gradient(90deg, rgba(229, 57, 53, 0.04) 1px, transparent 1px);
            background-size: 60px 60px;
            mask-image: radial-gradient(ellipse 80% 80% at 50% 50%, black 40%, transparent 100%);
            pointer-events: none;
        }

        /* Red radial glow behind the 404 */
        .error-page::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(229, 57, 53, 0.08) 0%, transparent 70%);
            pointer-events: none;
        }

        .error-content {
            position: relative;
            z-index: 1;
            text-align: center;
            max-width: 680px;
        }

        /* â”€â”€â”€ Big 404 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .error-code-wrap {
            position: relative;
            margin-bottom: 2rem;
            display: inline-block;
        }

        .error-code {
            font-size: clamp(120px, 20vw, 200px);
            font-weight: 900;
            line-height: 1;
            letter-spacing: -8px;
            background: linear-gradient(135deg, #E53935 0%, #FF6B6B 40%, #C62828 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 40px rgba(229, 57, 53, 0.5));
            user-select: none;
        }

        /* Steering wheel overlay on the middle zero */
        .wheel-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(60px, 10vw, 96px);
            color: rgba(229, 57, 53, 0.15);
            pointer-events: none;
            animation: spin 12s linear infinite;
        }

        @keyframes spin {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to   { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* â”€â”€â”€ Status badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .error-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(229, 57, 53, 0.1);
            border: 1px solid rgba(229, 57, 53, 0.3);
            border-radius: 100px;
            padding: 0.375rem 1rem;
            font-size: 12px;
            font-weight: 600;
            color: var(--racing-red);
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 1.5rem;
        }

        .error-badge .material-symbols-outlined {
            font-size: 14px;
        }

        /* â”€â”€â”€ Text â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .error-title {
            font-size: clamp(24px, 4vw, 36px);
            font-weight: 700;
            color: var(--pure-white);
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .error-title span {
            color: var(--racing-red);
        }

        .error-description {
            font-size: 16px;
            color: var(--silver);
            margin-bottom: 2.5rem;
            max-width: 480px;
            margin-left: auto;
            margin-right: auto;
        }

        /* â”€â”€â”€ CTA Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .error-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 3.5rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.875rem 1.75rem;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 0.5px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
        }

        .btn .material-symbols-outlined { font-size: 18px; }

        .btn-primary {
            background: var(--racing-red);
            color: var(--pure-white);
            box-shadow: var(--shadow-glow);
        }

        .btn-primary:hover {
            background: #C62828;
            box-shadow: 0 0 30px rgba(229, 57, 53, 0.6);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: transparent;
            color: var(--pure-white);
            border: 1px solid var(--graphite);
        }

        .btn-secondary:hover {
            border-color: var(--electric-blue);
            color: var(--electric-blue);
            box-shadow: var(--shadow-glow-blue);
            transform: translateY(-2px);
        }

        /* â”€â”€â”€ Quick links â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .quick-links-label {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--smoke);
            margin-bottom: 1.25rem;
        }

        .quick-links {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .quick-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.25rem;
            background: var(--carbon-gray);
            border: 1px solid var(--graphite);
            border-radius: 8px;
            color: var(--silver);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .quick-link .material-symbols-outlined { font-size: 16px; }

        .quick-link:hover {
            background: var(--graphite);
            color: var(--pure-white);
            border-color: var(--silver);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* â”€â”€â”€ Divider â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .divider {
            width: 100%;
            max-width: 400px;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--graphite), transparent);
            margin: 2.5rem auto;
        }

        /* â”€â”€â”€ Search bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .error-search {
            display: flex;
            gap: 0.5rem;
            max-width: 420px;
            margin: 0 auto;
        }

        .search-input-wrap {
            flex: 1;
            position: relative;
        }

        .search-input-wrap .material-symbols-outlined {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--silver);
            pointer-events: none;
        }

        .search-input {
            width: 100%;
            background: var(--carbon-gray);
            border: 1px solid var(--graphite);
            border-radius: 8px;
            padding: 0.875rem 1rem 0.875rem 2.75rem;
            color: var(--pure-white);
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s, box-shadow 0.3s;
            outline: none;
        }

        .search-input::placeholder { color: var(--smoke); }

        .search-input:focus {
            border-color: var(--electric-blue);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .search-btn {
            background: var(--racing-red);
            border: none;
            border-radius: 8px;
            color: var(--pure-white);
            cursor: pointer;
            padding: 0 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .search-btn:hover {
            background: #C62828;
            box-shadow: var(--shadow-glow);
        }

        /* â”€â”€â”€ Skid-mark decorations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .skid-marks {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 120px;
            pointer-events: none;
            overflow: hidden;
            opacity: 0.4;
        }

        .skid {
            position: absolute;
            bottom: 0;
            height: 100%;
            width: 18px;
            background: linear-gradient(to top, rgba(229, 57, 53, 0.25), transparent);
            border-radius: 2px 2px 0 0;
        }

        .skid:nth-child(1) { left: 15%; transform: rotate(-4deg); }
        .skid:nth-child(2) { left: calc(15% + 26px); transform: rotate(-4deg); }
        .skid:nth-child(3) { right: 15%; transform: rotate(4deg); }
        .skid:nth-child(4) { right: calc(15% + 26px); transform: rotate(4deg); }

        /* â”€â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 640px) {
            .nav-links { display: none; }
            .error-actions { flex-direction: column; align-items: center; }
            .error-search { flex-direction: column; }
            .search-btn { padding: 0.875rem; }
        }

        /* â”€â”€â”€ Easter egg hint â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .easter-hint {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            font-size: 11px;
            color: var(--smoke);
            letter-spacing: 1px;
            cursor: default;
            user-select: none;
            transition: color 0.3s;
        }
        .easter-hint:hover { color: var(--silver); }

        /* â”€â”€â”€ Game overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #game-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.92);
            backdrop-filter: blur(6px);
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }
        #game-overlay.visible { display: flex; }

        #game-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            max-width: 420px;
            padding: 0 0.25rem;
        }

        #game-title {
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--racing-red);
        }

        #game-score-wrap {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .game-stat {
            text-align: right;
        }
        .game-stat-label {
            font-size: 9px;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: var(--smoke);
        }
        .game-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--pure-white);
            line-height: 1;
        }

        #game-close {
            background: transparent;
            border: 1px solid var(--graphite);
            color: var(--silver);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            margin-left: 1rem;
        }
        #game-close:hover { border-color: var(--racing-red); color: var(--racing-red); }

        /* Canvas */
        #game-canvas {
            border: 1px solid var(--graphite);
            border-radius: 12px;
            display: block;
            box-shadow: 0 0 40px rgba(229,57,53,0.15);
        }

        /* Controls hint */
        #game-controls {
            font-size: 11px;
            color: var(--smoke);
            letter-spacing: 1px;
            text-align: center;
        }
        #game-controls span { color: var(--silver); }

        /* Start / Game over screens drawn on canvas */
    </style>
</head>
<body>

    <!-- â”€â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <header class="site-header">
        <div class="header-container">
            <a href="#" class="logo">SIM<span>RACING</span></a>

            <nav>
                <ul class="nav-links">
                    <li><a href="#">Volantes</a></li>
                    <li><a href="#">Pedales</a></li>
                    <li><a href="#">Butacas</a></li>
                    <li><a href="#">Cockpits</a></li>
                    <li><a href="#">Ofertas</a></li>
                </ul>
            </nav>

            <div class="header-actions">
                <button class="icon-btn" aria-label="Buscar">
                    <span class="material-symbols-outlined">search</span>
                </button>
                <button class="icon-btn" aria-label="Lista de deseos">
                    <span class="material-symbols-outlined">favorite</span>
                </button>
                <button class="icon-btn" aria-label="Mi cuenta">
                    <span class="material-symbols-outlined">account_circle</span>
                </button>
                <button class="icon-btn" aria-label="Carrito">
                    <span class="material-symbols-outlined">shopping_cart</span>
                </button>
            </div>
        </div>
    </header>

    <!-- â”€â”€â”€ 404 Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <main class="error-page">

        <!-- Background decorations -->
        <div class="skid-marks" aria-hidden="true">
            <div class="skid"></div>
            <div class="skid"></div>
            <div class="skid"></div>
            <div class="skid"></div>
        </div>

        <div class="error-content">
            <!-- Big 404 number (click 3Ã— or Konami code to unlock easter egg) -->
            <div class="error-code-wrap" aria-hidden="true" id="code404" title="Â¿Buscas algo mÃ¡s?">
                <div class="error-code" style="cursor:pointer">404</div>
                <span class="material-symbols-outlined wheel-icon">settings</span>
            </div>

            <!-- Title & description -->
            <h1 class="error-title">
                Parece que has salido de<br><span>la pista</span>
            </h1>
            <p class="error-description">
                La pÃ¡gina que buscas no existe, ha sido movida o el enlace estÃ¡ roto.
                Comprueba la URL o vuelve a la recta principal.
            </p>

            <!-- Primary CTAs -->
            <div class="error-actions">
                <a href="#" class="btn btn-primary">
                    <span class="material-symbols-outlined">home</span>
                    Volver al inicio
                </a>
                <a href="#" class="btn btn-secondary">
                    <span class="material-symbols-outlined">storefront</span>
                    Ver productos
                </a>
            </div>
        </div>
    </main>

    <!-- â”€â”€â”€ Easter egg hint â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="easter-hint" aria-hidden="true">â†‘â†‘â†“â†“â†â†’â†â†’BA</div>

    <!-- â”€â”€â”€ Game overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="game-overlay" role="dialog" aria-label="Mini juego SimRacing">
        <div id="game-header">
            <span id="game-title">ğŸ SimRun 404</span>
            <div id="game-score-wrap">
                <div class="game-stat">
                    <div class="game-stat-label">Vuelta</div>
                    <div class="game-stat-value" id="gs-score">0</div>
                </div>
                <div class="game-stat">
                    <div class="game-stat-label">RÃ©cord</div>
                    <div class="game-stat-value" id="gs-best">0</div>
                </div>
            </div>
            <button id="game-close" aria-label="Cerrar juego">âœ•</button>
        </div>

        <canvas id="game-canvas" width="380" height="520"></canvas>

        <div id="game-controls">
            <span>â† â†’</span> mover Â· <span>ESPACIO</span> nitro Â· <span>ESC</span> salir
        </div>
    </div>

    <script>
        /* â”€â”€ Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        const searchInput = document.querySelector('.search-input');
        const searchBtn   = document.querySelector('.search-btn');
        function doSearch() {
            const q = searchInput.value.trim();
            if (q) window.location.href = `/buscar?q=${encodeURIComponent(q)}`;
        }
        searchBtn.addEventListener('click', doSearch);
        searchInput.addEventListener('keydown', e => { if (e.key === 'Enter') doSearch(); });

        /* â”€â”€ Easter egg triggers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        // 1) Konami code
        const KONAMI = ['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','b','a'];
        let konamiIdx = 0;
        document.addEventListener('keydown', e => {
            if (e.key === KONAMI[konamiIdx]) {
                konamiIdx++;
                if (konamiIdx === KONAMI.length) { konamiIdx = 0; openGame(); }
            } else {
                konamiIdx = e.key === KONAMI[0] ? 1 : 0;
            }
        });

        // 2) Triple click on 404
        let clickCount = 0, clickTimer = null;
        document.getElementById('code404').addEventListener('click', () => {
            clickCount++;
            clearTimeout(clickTimer);
            if (clickCount >= 3) { clickCount = 0; openGame(); }
            else { clickTimer = setTimeout(() => { clickCount = 0; }, 600); }
        });

        /* â”€â”€ Game â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        const overlay = document.getElementById('game-overlay');
        const canvas  = document.getElementById('game-canvas');
        const ctx     = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;

        const COLORS = {
            road:    '#111',
            lane:    '#262626',
            line:    '#E53935',
            white:   '#fff',
            silver:  '#9CA3AF',
            red:     '#E53935',
            blue:    '#2196F3',
            gold:    '#C9AF89',
            smoke:   '#4B5563',
        };

        const LANE_X   = [60, 130, 200, 270, 340];  // 5 lanes
        const LANE_W   = 60;
        const NUM_LANES = 5;

        let state, raf;

        function initState() {
            return {
                phase: 'start',   // start | playing | over
                score: 0,
                best:  parseInt(localStorage.getItem('simrun404best') || '0'),
                speed: 3,
                nitro: 0,         // frames remaining
                nitroCharge: 100, // 0-100
                roadY: 0,
                lines: Array.from({length: 8}, (_, i) => ({ y: i * 70 })),
                player: { lane: 2, x: LANE_X[2], targetX: LANE_X[2], y: H - 110, w: 32, h: 56, tilt: 0 },
                enemies: [],
                particles: [],
                spawnTimer: 0,
                spawnInterval: 90,
                frame: 0,
                keys: {},
                touchDir: null,
            };
        }

        function openGame() {
            state = initState();
            overlay.classList.add('visible');
            document.getElementById('gs-best').textContent = state.best;
            canvas.focus();
            loop();
        }

        function closeGame() {
            overlay.classList.remove('visible');
            cancelAnimationFrame(raf);
        }

        document.getElementById('game-close').addEventListener('click', closeGame);
        document.addEventListener('keydown', e => { if (e.key === 'Escape' && overlay.classList.contains('visible')) closeGame(); });

        /* Controls */
        window.addEventListener('keydown', e => {
            if (!overlay.classList.contains('visible')) return;
            state.keys[e.key] = true;
            if (e.key === ' ') e.preventDefault();
            if ((e.key === 'ArrowLeft' || e.key === 'ArrowRight') && state.phase === 'playing') e.preventDefault();
            if (e.key === ' ' && state.phase === 'start') startGame();
            if (e.key === ' ' && state.phase === 'over')  restartGame();
        });
        window.addEventListener('keyup', e => { if (state) state.keys[e.key] = false; });

        // Touch / swipe
        let touchStartX = null;
        canvas.addEventListener('touchstart', e => { touchStartX = e.touches[0].clientX; }, {passive:true});
        canvas.addEventListener('touchend', e => {
            if (!state || state.phase !== 'playing') { if (state.phase !== 'playing') { if(state.phase==='start') startGame(); else restartGame(); } return; }
            const dx = e.changedTouches[0].clientX - touchStartX;
            if (Math.abs(dx) > 20) state.touchDir = dx < 0 ? 'left' : 'right';
        }, {passive:true});
        canvas.addEventListener('click', () => {
            if (!state) return;
            if (state.phase === 'start') startGame();
            else if (state.phase === 'over') restartGame();
        });

        function startGame()   { state.phase = 'playing'; }
        function restartGame() { const best = state.best; state = initState(); state.phase = 'playing'; state.best = best; document.getElementById('gs-best').textContent = best; }

        /* â”€â”€ Main loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function loop() {
            raf = requestAnimationFrame(loop);
            update();
            draw();
        }

        function update() {
            if (state.phase !== 'playing') return;
            state.frame++;

            // Score & speed ramp
            if (state.frame % 6 === 0) {
                state.score++;
                document.getElementById('gs-score').textContent = state.score;
                if (state.score > state.best) {
                    state.best = state.score;
                    localStorage.setItem('simrun404best', state.best);
                    document.getElementById('gs-best').textContent = state.best;
                }
            }
            state.speed = 3 + Math.floor(state.score / 30) * 0.5;

            // Nitro
            const isNitro = (state.keys[' '] || state.keys['Space']) && state.nitroCharge > 0;
            if (isNitro) { state.nitro = 6; state.nitroCharge = Math.max(0, state.nitroCharge - 1.2); }
            else { state.nitroCharge = Math.min(100, state.nitroCharge + 0.3); }
            const spd = state.speed + (state.nitro > 0 ? 4 : 0);
            if (state.nitro > 0) state.nitro--;

            // Road scroll
            state.roadY = (state.roadY + spd) % 70;
            state.lines.forEach(l => { l.y = (l.y + spd) % (H + 20); });

            // Player movement
            const p = state.player;
            let moved = false;
            if ((state.keys['ArrowLeft'] || state.touchDir === 'left') && p.lane > 0) {
                p.lane--; p.targetX = LANE_X[p.lane]; moved = true; state.touchDir = null;
                state.keys['ArrowLeft'] = false;
            }
            if ((state.keys['ArrowRight'] || state.touchDir === 'right') && p.lane < NUM_LANES - 1) {
                p.lane++; p.targetX = LANE_X[p.lane]; moved = true; state.touchDir = null;
                state.keys['ArrowRight'] = false;
            }
            p.x += (p.targetX - p.x) * 0.18;
            p.tilt += (p.targetX - p.x) * 0.006;
            p.tilt *= 0.85;

            // Spawn enemies
            state.spawnTimer++;
            state.spawnInterval = Math.max(35, 90 - Math.floor(state.score / 20) * 5);
            if (state.spawnTimer >= state.spawnInterval) {
                state.spawnTimer = 0;
                const lane = Math.floor(Math.random() * NUM_LANES);
                const types = ['rival','rival','rival','slow','slow'];
                const type = types[Math.floor(Math.random() * types.length)];
                state.enemies.push({ lane, x: LANE_X[lane], y: -70, w: 28, h: 52, type,
                    color: type === 'slow' ? COLORS.blue : ['#ff4444','#ff8800','#ffcc00','#44ff44','#cc44ff'][Math.floor(Math.random()*5)],
                    spd: type === 'slow' ? spd * 0.3 : spd * 0.7 });
            }

            // Move enemies & collision
            state.enemies = state.enemies.filter(e => {
                e.y += (spd - e.spd);
                if (e.y > H + 80) return false;

                // Collision
                const dx = Math.abs(p.x - e.x);
                const dy = Math.abs((p.y + p.h/2) - (e.y + e.h/2));
                if (dx < (p.w + e.w) * 0.42 && dy < (p.h + e.h) * 0.38) {
                    // Explode
                    for (let i = 0; i < 24; i++) {
                        const angle = (Math.PI * 2 * i) / 24;
                        const spd2 = 2 + Math.random() * 4;
                        state.particles.push({ x: p.x, y: p.y, vx: Math.cos(angle)*spd2, vy: Math.sin(angle)*spd2,
                            life: 1, color: [COLORS.red, COLORS.gold, COLORS.white][i%3], r: 2+Math.random()*3 });
                    }
                    state.phase = 'over';
                    return false;
                }
                return true;
            });

            // Particles
            state.particles = state.particles.filter(pt => {
                pt.x += pt.vx; pt.y += pt.vy; pt.vy += 0.1; pt.life -= 0.035;
                return pt.life > 0;
            });
        }

        /* â”€â”€ Drawing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function draw() {
            ctx.clearRect(0, 0, W, H);

            // Road background
            ctx.fillStyle = COLORS.road;
            ctx.fillRect(0, 0, W, H);

            // Lane dividers
            ctx.strokeStyle = COLORS.lane;
            ctx.lineWidth = 1;
            for (let i = 1; i < NUM_LANES; i++) {
                const x = 45 + i * LANE_W - LANE_W/2;
                ctx.setLineDash([30, 40]);
                ctx.lineDashOffset = -state.roadY;
                ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, H); ctx.stroke();
            }
            ctx.setLineDash([]);

            // Road borders
            ctx.strokeStyle = COLORS.red;
            ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(28, 0); ctx.lineTo(28, H); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(W - 28, 0); ctx.lineTo(W - 28, H); ctx.stroke();

            if (state.phase === 'start') {
                drawStartScreen(); return;
            }

            // Enemies
            state.enemies.forEach(e => drawCar(e.x, e.y, e.w, e.h, e.color, false, 0));

            // Player
            const p = state.player;
            const isNitro2 = state.nitro > 0;
            if (isNitro2) {
                // Nitro flame
                ctx.save();
                ctx.translate(p.x, p.y + p.h * 0.55);
                const grad = ctx.createRadialGradient(0, 0, 0, 0, 20, 20);
                grad.addColorStop(0, 'rgba(255,200,50,0.9)');
                grad.addColorStop(0.5, 'rgba(229,57,53,0.6)');
                grad.addColorStop(1, 'rgba(229,57,53,0)');
                ctx.fillStyle = grad;
                ctx.beginPath(); ctx.ellipse(0, 10, 8, 22, 0, 0, Math.PI*2); ctx.fill();
                ctx.restore();
            }
            drawCar(p.x, p.y, p.w, p.h, COLORS.white, true, p.tilt);

            // Particles
            state.particles.forEach(pt => {
                ctx.save();
                ctx.globalAlpha = pt.life;
                ctx.fillStyle = pt.color;
                ctx.beginPath(); ctx.arc(pt.x, pt.y, pt.r, 0, Math.PI*2); ctx.fill();
                ctx.restore();
            });

            if (state.phase === 'over') drawGameOver();

            // HUD â€” nitro bar
            const barW = 100, barH = 6, barX = W/2 - barW/2, barY = H - 18;
            ctx.fillStyle = COLORS.lane;
            roundRect(ctx, barX, barY, barW, barH, 3); ctx.fill();
            const pct = state.nitroCharge / 100;
            const barGrad = ctx.createLinearGradient(barX, 0, barX + barW, 0);
            barGrad.addColorStop(0, '#2196F3');
            barGrad.addColorStop(1, '#E53935');
            ctx.fillStyle = barGrad;
            roundRect(ctx, barX, barY, barW * pct, barH, 3); ctx.fill();

            ctx.fillStyle = COLORS.smoke;
            ctx.font = '9px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('NITRO', W/2, barY - 3);
        }

        function drawCar(x, y, w, h, color, isPlayer, tilt) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(tilt);

            // Body
            ctx.fillStyle = color;
            roundRect(ctx, -w/2, -h/2, w, h, 5);
            ctx.fill();

            // Windshield
            ctx.fillStyle = isPlayer ? 'rgba(33,150,243,0.6)' : 'rgba(0,0,0,0.5)';
            roundRect(ctx, -w/2 + 4, -h/2 + 6, w - 8, h * 0.28, 3);
            ctx.fill();

            // Wheels
            ctx.fillStyle = '#111';
            [[-w/2 - 3, -h/2 + 6], [w/2 - 4, -h/2 + 6], [-w/2 - 3, h/2 - 14], [w/2 - 4, h/2 - 14]].forEach(([wx, wy]) => {
                roundRect(ctx, wx, wy, 7, 10, 2); ctx.fill();
            });

            // Brake lights / headlights
            ctx.fillStyle = isPlayer ? COLORS.red : 'rgba(255,255,100,0.8)';
            [[-w/2 + 3, isPlayer ? h/2 - 8 : -h/2 + 2], [w/2 - 8, isPlayer ? h/2 - 8 : -h/2 + 2]].forEach(([lx, ly]) => {
                roundRect(ctx, lx, ly, 5, 4, 1); ctx.fill();
            });

            ctx.restore();
        }

        function drawStartScreen() {
            ctx.fillStyle = 'rgba(0,0,0,0.7)';
            ctx.fillRect(0, 0, W, H);

            // Logo
            ctx.fillStyle = COLORS.red;
            ctx.font = 'bold 42px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('SimRun', W/2, H/2 - 70);

            ctx.fillStyle = COLORS.white;
            ctx.font = 'bold 18px Inter, sans-serif';
            ctx.fillText('404', W/2, H/2 - 40);

            ctx.fillStyle = COLORS.silver;
            ctx.font = '13px Inter, sans-serif';
            ctx.fillText('Esquiva a los rivales', W/2, H/2);
            ctx.fillText('y no salgas de la pista', W/2, H/2 + 20);

            // Pulse effect
            const pulse = 0.7 + 0.3 * Math.sin(Date.now() / 300);
            ctx.globalAlpha = pulse;
            ctx.fillStyle = COLORS.red;
            ctx.font = 'bold 14px Inter, sans-serif';
            ctx.fillText('PULSA ESPACIO / TOCA PARA INICIAR', W/2, H/2 + 70);
            ctx.globalAlpha = 1;

            ctx.fillStyle = COLORS.smoke;
            ctx.font = '11px Inter, sans-serif';
            ctx.fillText('â† â†’ para mover Â· ESPACIO para nitro', W/2, H/2 + 100);
        }

        function drawGameOver() {
            ctx.fillStyle = 'rgba(0,0,0,0.78)';
            ctx.fillRect(0, 0, W, H);

            ctx.fillStyle = COLORS.red;
            ctx.font = 'bold 36px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('CRASH!', W/2, H/2 - 60);

            ctx.fillStyle = COLORS.white;
            ctx.font = 'bold 16px Inter, sans-serif';
            ctx.fillText(`PuntuaciÃ³n: ${state.score}`, W/2, H/2 - 20);

            ctx.fillStyle = COLORS.gold;
            ctx.font = '14px Inter, sans-serif';
            ctx.fillText(`RÃ©cord: ${state.best}`, W/2, H/2 + 8);

            const pulse = 0.7 + 0.3 * Math.sin(Date.now() / 280);
            ctx.globalAlpha = pulse;
            ctx.fillStyle = COLORS.red;
            ctx.font = 'bold 13px Inter, sans-serif';
            ctx.fillText('ESPACIO / TOCA PARA REINICIAR', W/2, H/2 + 55);
            ctx.globalAlpha = 1;
        }

        function roundRect(ctx, x, y, w, h, r) {
            ctx.beginPath();
            ctx.roundRect(x, y, w, h, r);
        }

    </script>

</body>
</html>
